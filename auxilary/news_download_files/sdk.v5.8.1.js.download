/*! *****************************************************************************
 * @dory/fe-sdk - v5.8.1
 ***************************************************************************** */
function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)},_wrapNativeSuper(e)}function _construct(e,t,n){return _construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i},_construct.apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),s=new A(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return _()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=T(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function h(){}function f(){}function d(){}var p={};a(p,i,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(R([])));m&&m!==t&&n.call(m,i)&&(p=m);var y=d.prototype=h.prototype=Object.create(p);function E(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function g(e,t){function r(i,o,s,a){var c=u(e[i],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==_typeof2(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,s,a)}),(function(e){r("throw",e,s,a)})):t.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,a)}))}a(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function b(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(b,this),this.reset(!0)}function R(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:_}}function _(){return{value:void 0,done:!0}}return f.prototype=d,a(y,"constructor",d),a(d,"constructor",f),f.displayName=a(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},E(g.prototype),a(g.prototype,o,(function(){return this})),e.AsyncIterator=g,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new g(c(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(y),a(y,s,"Generator"),a(y,i,(function(){return this})),a(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=R,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return s.type="throw",s.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var a=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:R(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof2(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck2(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _typeof2(e){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof2(e)}!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).dory=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}function n(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}t((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,o=Object.create(i.prototype),s=new I(r||[]);return o._invoke=function(e,t,n){var r=h;return function(i,o){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw o;return N()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=_(s,n);if(a){if(a===v)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?p:f,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=p,n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",v={};function m(){}function y(){}function E(){}var g={};c(g,o,(function(){return this}));var T=Object.getPrototypeOf,b=T&&T(T(k([])));b&&b!==n&&r.call(b,o)&&(g=b);var S=E.prototype=m.prototype=Object.create(g);function A(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(i,o,s,a){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"===_typeof2(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(h).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function _(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function k(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:N}}function N(){return{value:t,done:!0}}return y.prototype=E,c(S,"constructor",E),c(E,"constructor",y),y.displayName=c(E,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,c(e,a,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},A(R.prototype),c(R.prototype,s,(function(){return this})),e.AsyncIterator=R,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new R(u(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},A(S),c(S,a,"Generator"),c(S,o,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(w),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;w(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:k(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":_typeof2(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}));var i=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},o=Object.prototype.toString;function s(e){return"[object Array]"===o.call(e)}function a(e){return void 0===e}function c(e){return null!==e&&"object"===_typeof2(e)}function u(e){if("[object Object]"!==o.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function l(e){return"[object Function]"===o.call(e)}function h(e,t){if(null!=e)if("object"!==_typeof2(e)&&(e=[e]),s(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var f={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===o.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:u,isUndefined:a,isDate:function(e){return"[object Date]"===o.call(e)},isFile:function(e){return"[object File]"===o.call(e)},isBlob:function(e){return"[object Blob]"===o.call(e)},isFunction:l,isStream:function(e){return c(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:h,merge:function e(){var t={};function n(n,r){u(t[r])&&u(n)?t[r]=e(t[r],n):u(n)?t[r]=e({},n):s(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)h(arguments[r],n);return t},extend:function(e,t,n){return h(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function d(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var p=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(f.isURLSearchParams(t))r=t.toString();else{var i=[];f.forEach(t,(function(e,t){null!=e&&(f.isArray(e)?t+="[]":e=[e],f.forEach(e,(function(e){f.isDate(e)?e=e.toISOString():f.isObject(e)&&(e=JSON.stringify(e)),i.push(d(t)+"="+d(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e};function v(){this.handlers=[]}v.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},v.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},v.prototype.forEach=function(e){f.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var m=v,y=function(e,t){f.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},E=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e},g=function(e,t,n,r,i){var o=new Error(e);return E(o,t,n,r,i)},T=f.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var s=[];s.push(e+"="+encodeURIComponent(t)),f.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),f.isString(r)&&s.push("path="+r),f.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},b=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],S=f.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=f.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},A=function(e){return new Promise((function(t,n){var r=e.data,i=e.headers,o=e.responseType;f.isFormData(r)&&delete i["Content-Type"];var s=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",c=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.Authorization="Basic "+btoa(a+":"+c)}var u,l,h=(u=e.baseURL,l=e.url,u&&!function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}(l)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(u,l):l);function d(){if(s){var r="getAllResponseHeaders"in s?function(e){var t,n,r,i={};return e?(f.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=f.trim(e.substr(0,r)).toLowerCase(),n=f.trim(e.substr(r+1)),t){if(i[t]&&b.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i}(s.getAllResponseHeaders()):null,i={data:o&&"text"!==o&&"json"!==o?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:r,config:e,request:s};!function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(g("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}(t,n,i),s=null}}if(s.open(e.method.toUpperCase(),p(h,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,"onloadend"in s?s.onloadend=d:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(d)},s.onabort=function(){s&&(n(g("Request aborted",e,"ECONNABORTED",s)),s=null)},s.onerror=function(){n(g("Network Error",e,null,s)),s=null},s.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(g(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",s)),s=null},f.isStandardBrowserEnv()){var v=(e.withCredentials||S(h))&&e.xsrfCookieName?T.read(e.xsrfCookieName):void 0;v&&(i[e.xsrfHeaderName]=v)}"setRequestHeader"in s&&f.forEach(i,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:s.setRequestHeader(t,e)})),f.isUndefined(e.withCredentials)||(s.withCredentials=!!e.withCredentials),o&&"json"!==o&&(s.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(s.abort(),n(e),s=null)})),r||(r=null),s.send(r)}))},R={"Content-Type":"application/x-www-form-urlencoded"};function _(e,t){!f.isUndefined(e)&&f.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var O,w={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(O=A),O),transformRequest:[function(e,t){return y(t,"Accept"),y(t,"Content-Type"),f.isFormData(e)||f.isArrayBuffer(e)||f.isBuffer(e)||f.isStream(e)||f.isFile(e)||f.isBlob(e)?e:f.isArrayBufferView(e)?e.buffer:f.isURLSearchParams(e)?(_(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):f.isObject(e)||t&&"application/json"===t["Content-Type"]?(_(t,"application/json"),function(e,t,n){if(f.isString(e))try{return(t||JSON.parse)(e),f.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&f.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw E(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};w.headers={common:{Accept:"application/json, text/plain, */*"}},f.forEach(["delete","get","head"],(function(e){w.headers[e]={}})),f.forEach(["post","put","patch"],(function(e){w.headers[e]=f.merge(R)}));var I=w,k=function(e,t,n){var r=this||I;return f.forEach(n,(function(n){e=n.call(r,e,t)})),e},N=function(e){return!(!e||!e.__CANCEL__)};function C(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var D,M=function(e){return C(e),e.headers=e.headers||{},e.data=k.call(e,e.data,e.headers,e.transformRequest),e.headers=f.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),f.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||I.adapter)(e).then((function(t){return C(e),t.data=k.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return N(t)||(C(e),t&&t.response&&(t.response.data=k.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},U=function(e,t){t=t||{};var n={},r=["url","method","data"],i=["headers","auth","proxy","params"],o=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],s=["validateStatus"];function a(e,t){return f.isPlainObject(e)&&f.isPlainObject(t)?f.merge(e,t):f.isPlainObject(t)?f.merge({},t):f.isArray(t)?t.slice():t}function c(r){f.isUndefined(t[r])?f.isUndefined(e[r])||(n[r]=a(void 0,e[r])):n[r]=a(e[r],t[r])}f.forEach(r,(function(e){f.isUndefined(t[e])||(n[e]=a(void 0,t[e]))})),f.forEach(i,c),f.forEach(o,(function(r){f.isUndefined(t[r])?f.isUndefined(e[r])||(n[r]=a(void 0,e[r])):n[r]=a(void 0,t[r])})),f.forEach(s,(function(r){r in t?n[r]=a(e[r],t[r]):r in e&&(n[r]=a(void 0,e[r]))}));var u=r.concat(i).concat(o).concat(s),l=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return f.forEach(l,c),n},L="axios",P="0.21.4",x="Promise based HTTP client for the browser and node.js",j="index.js",B={test:"grunt test",start:"node ./sandbox/server.js",build:"NODE_ENV=production grunt build",preversion:"npm test",version:"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json",postversion:"git push && git push --tags",examples:"node ./examples/server.js",coveralls:"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js",fix:"eslint --fix lib/**/*.js"},G={type:"git",url:"https://github.com/axios/axios.git"},K=["xhr","http","ajax","promise","node"],Q="Matt Zabriskie",F={url:"https://github.com/axios/axios/issues"},q="https://axios-http.com",H={coveralls:"^3.0.0","es6-promise":"^4.2.4",grunt:"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1",karma:"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2",minimist:"^1.2.0",mocha:"^8.2.1",sinon:"^4.5.0","terser-webpack-plugin":"^4.2.3",typescript:"^4.0.5","url-search-params":"^0.10.0",webpack:"^4.44.2","webpack-dev-server":"^3.11.0"},W={"./lib/adapters/http.js":"./lib/adapters/xhr.js"},V="dist/axios.min.js",J="dist/axios.min.js",z="./index.d.ts",X={"follow-redirects":"^1.14.0"},$=[{path:"./dist/axios.min.js",threshold:"5kB"}],Y={name:L,version:P,description:x,main:j,scripts:B,repository:G,keywords:K,author:Q,license:"MIT",bugs:F,homepage:q,devDependencies:H,browser:W,jsdelivr:V,unpkg:J,typings:z,dependencies:X,bundlesize:$},Z=(D=Object.freeze({__proto__:null,name:L,version:P,description:x,main:j,scripts:B,repository:G,keywords:K,author:Q,license:"MIT",bugs:F,homepage:q,devDependencies:H,browser:W,jsdelivr:V,unpkg:J,typings:z,dependencies:X,bundlesize:$,default:Y}))&&D.default||D,ee={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){ee[e]=function(n){return _typeof2(n)===e||"a"+(t<1?"n ":" ")+e}}));var te={},ne=Z.version.split(".");function re(e,t){for(var n=t?t.split("."):ne,r=e.split("."),i=0;i<3;i++){if(n[i]>r[i])return!0;if(n[i]<r[i])return!1}return!1}ee.transitional=function(e,t,n){var r=t&&re(t);function i(e,t){return"[Axios v"+Z.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,o,s){if(!1===e)throw new Error(i(o," has been removed in "+t));return r&&!te[o]&&(te[o]=!0,console.warn(i(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,o,s)}};var ie={isOlderVersion:re,assertOptions:function(e,t,n){if("object"!==_typeof2(e))throw new TypeError("options must be an object");for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new TypeError("option "+o+" must be "+c)}else if(!0!==n)throw Error("Unknown option "+o)}},validators:ee},oe=ie.validators;function se(e){this.defaults=e,this.interceptors={request:new m,response:new m}}se.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=U(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&ie.assertOptions(t,{silentJSONParsing:oe.transitional(oe.boolean,"1.0.0"),forcedJSONParsing:oe.transitional(oe.boolean,"1.0.0"),clarifyTimeoutError:oe.transitional(oe.boolean,"1.0.0")},!1);var n=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!r){var s=[M,void 0];for(Array.prototype.unshift.apply(s,n),s=s.concat(o),i=Promise.resolve(e);s.length;)i=i.then(s.shift(),s.shift());return i}for(var a=e;n.length;){var c=n.shift(),u=n.shift();try{a=c(a)}catch(e){u(e);break}}try{i=M(a)}catch(e){return Promise.reject(e)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},se.prototype.getUri=function(e){return e=U(this.defaults,e),p(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},f.forEach(["delete","get","head","options"],(function(e){se.prototype[e]=function(t,n){return this.request(U(n||{},{method:e,url:t,data:(n||{}).data}))}})),f.forEach(["post","put","patch"],(function(e){se.prototype[e]=function(t,n,r){return this.request(U(r||{},{method:e,url:t,data:n}))}}));var ae=se;function ce(e){this.message=e}ce.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},ce.prototype.__CANCEL__=!0;var ue=ce;function le(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new ue(e),t(n.reason))}))}le.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},le.source=function(){var e;return{token:new le((function(t){e=t})),cancel:e}};var he=le;function fe(e){var t=new ae(e),n=i(ae.prototype.request,t);return f.extend(n,ae.prototype,t),f.extend(n,t),n}var de=fe(I);de.Axios=ae,de.create=function(e){return fe(U(de.defaults,e))},de.Cancel=ue,de.CancelToken=he,de.isCancel=N,de.all=function(e){return Promise.all(e)},de.spread=function(e){return function(t){return e.apply(null,t)}},de.isAxiosError=function(e){return"object"===_typeof2(e)&&!0===e.isAxiosError};var pe=de,ve=de;pe.default=ve;var me,ye=pe,Ee=function(){function e(t){_classCallCheck2(this,e),this.requestTimeout=1e4,this.middleware=t}return _createClass(e,[{key:"RequestTimeout",get:function(){return this.requestTimeout},set:function(e){this.requestTimeout=e}},{key:"overrideRequestMethod",value:function(e,t){var n,r=e.url.split(/(\?)(?!.*\?)/);e.url=r[0],e.data=r[r.length-1],e.method="post",e.headers=Object.assign(Object.assign({},e.headers),(_defineProperty(n={},"Content-Type","text/plain"),_defineProperty(n,"X-HTTP-Method-Override",t),n))}},{key:"getRequestObject",value:function(e){var t;return e.headers||(e.headers={"Content-Type":"application/json",Accept:"application/json"},e.jwt&&(e.headers.jwt=e.jwt)),e.path.startsWith("http")||(e.path="".concat(this.middleware.url).concat(e.path)),{url:e.path,headers:e.headers,timeout:null!==(t=e.timeout)&&void 0!==t?t:this.requestTimeout,method:e.method,data:e.data}}},{key:"request",value:function(e,t){var n=this;return(t?t.validateToken().catch((function(e){return Promise.reject("Failed to validate token: ".concat(e))})).then((function(){return t.getTokenString()})).catch((function(e){return Promise.reject("Failed to get token string: ".concat(e))})).then((function(t){return n.getRequestObject(Object.assign({jwt:t},e))})):Promise.resolve(this.getRequestObject(e))).then((function(e){switch(e.url.length>2e3&&("get"===e.method&&n.overrideRequestMethod(e,"GET"),"delete"===e.method&&n.overrideRequestMethod(e,"DELETE")),e.method){case"get":return e.url+="".concat(-1!==e.url.indexOf("?")?"&":"?","__ts=").concat((new Date).getTime()),ye.get(e.url,e);case"post":var t=e.data;return delete e.data,ye.post(e.url,t,e);case"put":var r=e.data;return delete e.data,ye.put(e.url,r,e);case"delete":return ye.delete(e.url,e)}}))}},{key:"get",value:function(e,t,n){if("function"!=typeof t||"function"!=typeof n)return this.request({method:"get",path:e},this.auth);this.request({method:"get",path:e},this.auth).then(t).catch(n)}},{key:"put",value:function(e,t){return this.request({method:"put",path:e,data:t},this.auth)}},{key:"post",value:function(e,t){return this.request({method:"post",path:e,data:t},this.auth)}},{key:"delete",value:function(e){return this.request({method:"delete",path:e},this.auth)}}]),e}();!function(e){e.set="set",e.add="add",e.remove="remove"}(me||(me={}));var ge=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck2(this,n),(i=t.call(this,e.admin)).auth=r,i.config=e,i}return _createClass(n,[{key:"setUrlEndpoint",value:function(e){this.config.admin.url=e}},{key:"getUrlEndpoint",value:function(){return this.config.admin.url}},{key:"getSessions",value:function(e){return r(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.get("/sessions?product=".concat(e)));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"getUserLoginInfo",value:function(e,t){return r(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.get("/users?product=".concat(e,"&loginname=").concat(t)));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"getUserDetails",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.get("/entities/".concat(e,"/userdetails?path=").concat(t,"&includeSource=").concat(n)));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"setUserDetails",value:function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:me.set;return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.post("/entities/".concat(e,"/userdetails"),{path:t,object:n,profile:i,action:o}));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"copyEntity",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.post("/entities/copy",{copyfrom:e,loginname:t,productname:n,validdays:i,firstTimeUser:o}));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"setUserPassword",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.put("/entities/logins/newpwd",{loginname:e,product:t,password:n,temporary:i}));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"setUserLoginValidityDays",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.put("/entities/logins/setvaliditydays",{loginname:e,product:t,validdays:n}));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"setUserIsActive",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.put("/entities/logins/setisactive",{loginname:e,product:t,active:n}));case 1:case"end":return r.stop()}}),r,this)})))}}]),n}(Ee),Te=t((function(t){var n,r;n=e,r=function(){function e(e){var t=[];if(0===e.length)return"";if("string"!=typeof e[0])throw new TypeError("Url must be a string. Received "+e[0]);if(e[0].match(/^[^/:]+:\/*$/)&&e.length>1){var n=e.shift();e[0]=n+e[0]}e[0].match(/^file:\/\/\//)?e[0]=e[0].replace(/^([^/:]+):\/*/,"$1:///"):e[0]=e[0].replace(/^([^/:]+):\/*/,"$1://");for(var r=0;r<e.length;r++){var i=e[r];if("string"!=typeof i)throw new TypeError("Url must be a string. Received "+i);""!==i&&(r>0&&(i=i.replace(/^[\/]+/,"")),i=r<e.length-1?i.replace(/[\/]+$/,""):i.replace(/[\/]+$/,"/"),t.push(i))}var o=t.join("/"),s=(o=o.replace(/\/(\?|&|#[^!])/g,"$1")).split("?");return o=s.shift()+(s.length>0?"?":"")+s.join("&")}return function(){return e("object"===_typeof2(arguments[0])?arguments[0]:[].slice.call(arguments))}},t.exports?t.exports=r():n.urljoin=r()})),be=t((function(t,r){
/*!
	    localForage -- Offline Storage, Improved
	    Version 1.10.0
	    https://localforage.github.io/localForage
	    (c) 2013-2017 Mozilla, Apache License 2.0
	*/
t.exports=function e(t,r,i){function o(a,c){if(!r[a]){if(!t[a]){if(!c&&n)return n();if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=r[a]={exports:{}};t[a][0].call(l.exports,(function(e){var n=t[a][1][e];return o(n||e)}),l,l.exports,e,t,r,i)}return r[a].exports}for(var s=n,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(t,n,r){(function(e){var t,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,s=new i(l),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),t=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)t="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,t=function(){c.port2.postMessage(0)}}var u=[];function l(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}function h(e){1!==u.push(e)||r||t()}n.exports=h}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function i(){}var o={},s=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&d(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"===_typeof2(e)||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function i(t){n||(n=!0,o.resolve(e,t))}function s(){t(i,r)}var a=p(s);"error"===a.status&&r(a.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function v(e){return e instanceof this?e:o.resolve(new this(i),e)}function m(e){var t=new this(i);return o.reject(t,e)}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,c=-1,u=new this(i);++c<n;)l(e[c],c);return u;function l(e,i){function c(e){s[i]=e,++a!==n||r||(r=!0,o.resolve(u,s))}t.resolve(e).then(c,(function(e){r||(r=!0,o.reject(u,e))}))}}function E(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var s=-1,a=new this(i);++s<n;)c(e[s]);return a;function c(e){t.resolve(e).then((function(e){r||(r=!0,o.resolve(a,e))}),(function(e){r||(r=!0,o.reject(a,e))}))}}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(i);return this.state!==c?h(n,this.state===a?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){o.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)d(e,r);else{e.state=a,e.outcome=t;for(var i=-1,s=e.queue.length;++i<s;)e.queue[i].callFulfilled(t)}return e},o.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=v,u.reject=m,u.all=y,u.race=E},{1:1}],3:[function(t,n,r){(function(e){"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var s=o();function a(){try{if(!s||!s.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var u=Promise;function l(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function h(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function f(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",v=void 0,m={},y=Object.prototype.toString,E="readonly",g="readwrite";function T(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function b(e){return new u((function(t){var n=e.transaction(p,g),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof v?u.resolve(v):b(e).then((function(e){return v=e}))}function A(e){var t=m[e.name],n={};n.promise=new u((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function R(e){var t=m[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function _(e,t){var n=m[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function O(e,t){return new u((function(n,r){if(m[e.name]=m[e.name]||P(),e.db){if(!t)return n(e.db);A(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var o=s.open.apply(s,i);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),r(o.error)},o.onsuccess=function(){var t=o.result;t.onversionchange=function(e){e.target.close()},n(t),R(e)}}))}function w(e){return O(e,!1)}function I(e){return O(e,!0)}function k(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function N(e){return new u((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function C(e){return c([T(atob(e.data))],{type:e.type})}function D(e){return e&&e.__local_forage_encoded_blob}function M(e){var t=this,n=t._initReady().then((function(){var e=m[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return h(n,e,e),n}function U(e){A(e);for(var t=m[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,w(e).then((function(t){return e.db=t,k(e)?I(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw _(e,t),t}))}function L(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return u.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),I(e)})).then((function(){return U(e).then((function(){L(e,t,n,r-1)}))})).catch(n);n(i)}}function P(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function x(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=m[n.name];i||(i=P(),m[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=M);var o=[];function s(){return u.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&o.push(c._initReady().catch(s))}var l=i.forages.slice(0);return u.all(o).then((function(){return n.db=i.db,w(n)})).then((function(e){return n.db=e,k(n,t._defaultConfig.version)?I(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var o=l[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))}function j(e,t){var n=this;e=f(e);var r=new u((function(t,r){n.ready().then((function(){L(n._dbInfo,E,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).get(e);s.onsuccess=function(){var e=s.result;void 0===e&&(e=null),D(e)&&(e=C(e)),t(e)},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return l(r,t),r}function B(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){L(n._dbInfo,E,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).openCursor(),a=1;s.onsuccess=function(){var n=s.result;if(n){var r=n.value;D(r)&&(r=C(r));var i=e(r,n.key,a++);void 0!==i?t(i):n.continue()}else t()},s.onerror=function(){r(s.error)}}catch(e){r(e)}}))})).catch(r)}));return l(r,t),r}function G(e,t,n){var r=this;e=f(e);var i=new u((function(n,i){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===y.call(t)?S(o.db).then((function(e){return e?t:N(t)})):t})).then((function(t){L(r._dbInfo,g,(function(o,s){if(o)return i(o);try{var a=s.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);s.oncomplete=function(){void 0===t&&(t=null),n(t)},s.onabort=s.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return l(i,n),i}function K(e,t){var n=this;e=f(e);var r=new u((function(t,r){n.ready().then((function(){L(n._dbInfo,g,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(s.error)},o.onabort=function(){var e=s.error?s.error:s.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return l(r,t),r}function Q(e){var t=this,n=new u((function(e,n){t.ready().then((function(){L(t._dbInfo,g,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return l(n,e),n}function F(e){var t=this,n=new u((function(e,n){t.ready().then((function(){L(t._dbInfo,E,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return l(n,e),n}function q(e,t){var n=this,r=new u((function(t,r){e<0?t(null):n.ready().then((function(){L(n._dbInfo,E,(function(i,o){if(i)return r(i);try{var s=o.objectStore(n._dbInfo.storeName),a=!1,c=s.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||a?t(n.key):(a=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return l(r,t),r}function H(e){var t=this,n=new u((function(e,n){t.ready().then((function(){L(t._dbInfo,E,(function(r,i){if(r)return n(r);try{var o=i.objectStore(t._dbInfo.storeName).openKeyCursor(),s=[];o.onsuccess=function(){var t=o.result;t?(s.push(t.key),t.continue()):e(s)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return l(n,e),n}function W(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var o=e.name===n.name&&i._dbInfo.db?u.resolve(i._dbInfo.db):w(e).then((function(t){var n=m[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?o.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;A(e);var r=m[e.name],i=r.forages;t.close();for(var o=0;o<i.length;o++){var a=i[o];a._dbInfo.db=null,a._dbInfo.version=n}var c=new u((function(t,r){var i=s.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,R(n._dbInfo)}})).catch((function(t){throw(_(e,t)||u.resolve()).catch((function(){})),t}))}})):o.then((function(t){A(e);var n=m[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var o=new u((function(t,n){var r=s.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return o.then((function(e){n.db=e;for(var t=0;t<r.length;t++)R(r[t]._dbInfo)})).catch((function(t){throw(_(e,t)||u.resolve()).catch((function(){})),t}))}))}else r=u.reject("Invalid arguments");return l(r,t),r}var V={_driver:"asyncStorage",_initStorage:x,_support:a(),iterate:B,getItem:j,setItem:G,removeItem:K,clear:Q,length:F,key:q,keys:H,dropInstance:W};function J(){return"function"==typeof openDatabase}var z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",X="~~local_forage_type~",$=/^~~local_forage_type~([^~]+)~/,Y="__lfsc__:",Z=Y.length,ee="arbf",te="blob",ne="si08",re="ui08",ie="uic8",oe="si16",se="si32",ae="ur16",ce="ui32",ue="fl32",le="fl64",he=Z+ee.length,fe=Object.prototype.toString;function de(e){var t,n,r,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u=new ArrayBuffer(s),l=new Uint8Array(u);for(t=0;t<a;t+=4)n=z.indexOf(e[t]),r=z.indexOf(e[t+1]),i=z.indexOf(e[t+2]),o=z.indexOf(e[t+3]),l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return u}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=z[n[t]>>2],r+=z[(3&n[t])<<4|n[t+1]>>4],r+=z[(15&n[t+1])<<2|n[t+2]>>6],r+=z[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function ve(e,t){var n="";if(e&&(n=fe.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===fe.call(e.buffer))){var r,i=Y;e instanceof ArrayBuffer?(r=e,i+=ee):(r=e.buffer,"[object Int8Array]"===n?i+=ne:"[object Uint8Array]"===n?i+=re:"[object Uint8ClampedArray]"===n?i+=ie:"[object Int16Array]"===n?i+=oe:"[object Uint16Array]"===n?i+=ae:"[object Int32Array]"===n?i+=se:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=ue:"[object Float64Array]"===n?i+=le:t(new Error("Failed to get type for BinaryArray"))),t(i+pe(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n=X+e.type+"~"+pe(this.result);t(Y+te+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function me(e){if(e.substring(0,Z)!==Y)return JSON.parse(e);var t,n=e.substring(he),r=e.substring(Z,he);if(r===te&&$.test(n)){var i=n.match($);t=i[1],n=n.substring(i[0].length)}var o=de(n);switch(r){case ee:return o;case te:return c([o],{type:t});case ne:return new Int8Array(o);case re:return new Uint8Array(o);case ie:return new Uint8ClampedArray(o);case oe:return new Int16Array(o);case ae:return new Uint16Array(o);case se:return new Int32Array(o);case ce:return new Uint32Array(o);case ue:return new Float32Array(o);case le:return new Float64Array(o);default:throw new Error("Unkown type: "+r)}}var ye={serialize:ve,deserialize:me,stringToBuffer:de,bufferToString:pe};function Ee(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function ge(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new u((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){Ee(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=ye,i}function Te(e,t,n,r,i,o){e.executeSql(n,r,i,(function(e,s){s.code===s.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?o(e,s):Ee(e,t,(function(){e.executeSql(n,r,i,o)}),o)}),o):o(e,s)}),o)}function be(e,t){var n=this;e=f(e);var r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Te(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,t),r}function Se(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Te(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var o=r.rows,s=o.length,a=0;a<s;a++){var c=o.item(a),u=c.value;if(u&&(u=i.serializer.deserialize(u)),void 0!==(u=e(u,c.key,a+1)))return void t(u)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,t),r}function Ae(e,t,n,r){var i=this;e=f(e);var o=new u((function(o,s){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,u){u?s(u):c.db.transaction((function(n){Te(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(a)}),(function(e,t){s(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(Ae.apply(i,[e,a,n,r-1]));s(t)}}))}))})).catch(s)}));return l(o,n),o}function Re(e,t,n){return Ae.apply(this,[e,t,n,1])}function _e(e,t){var n=this;e=f(e);var r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Te(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,t),r}function Oe(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Te(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,e),n}function we(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Te(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,e),n}function Ie(e,t){var n=this,r=new u((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){Te(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return l(r,t),r}function ke(e){var t=this,n=new u((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){Te(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return l(n,e),n}function Ne(e){return new u((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],o=0;o<r.rows.length;o++)i.push(r.rows.item(o).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Ce(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new u((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Ne(r))})).then((function(e){return new u((function(t,n){e.db.transaction((function(r){function i(e){return new u((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],s=0,a=e.storeNames.length;s<a;s++)o.push(i(e.storeNames[s]));u.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):u.reject("Invalid arguments"),l(r,t),r}var De={_driver:"webSQLStorage",_initStorage:ge,_support:J(),iterate:Se,getItem:be,setItem:Re,removeItem:_e,clear:Oe,length:we,key:Ie,keys:ke,dropInstance:Ce};function Me(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ue(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Le(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Pe(){return!Le()||localStorage.length>0}function xe(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ue(e,t._defaultConfig),Pe()?(t._dbInfo=n,n.serializer=ye,u.resolve()):u.reject()}function je(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return l(n,e),n}function Be(e,t){var n=this;e=f(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return l(r,t),r}function Ge(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,o=localStorage.length,s=1,a=0;a<o;a++){var c=localStorage.key(a);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(i),s++)))return u}}}));return l(r,t),r}function Ke(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return l(r,t),r}function Qe(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var o=localStorage.key(i);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return l(n,e),n}function Fe(e){var t=this.keys().then((function(e){return e.length}));return l(t,e),t}function qe(e,t){var n=this;e=f(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return l(r,t),r}function He(e,t,n){var r=this;e=f(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new u((function(i,o){var s=r._dbInfo;s.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(s.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return l(i,n),i}function We(e,t){if(t=d.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new u((function(t){e.storeName?t(Ue(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):u.reject("Invalid arguments"),l(r,t),r}var Ve={_driver:"localStorageWrapper",_initStorage:xe,_support:Me(),iterate:Ge,getItem:Be,setItem:He,removeItem:qe,clear:je,length:Fe,key:Ke,keys:Qe,dropInstance:We},Je=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},ze=function(e,t){for(var n=e.length,r=0;r<n;){if(Je(e[r],t))return!0;r++}return!1},Xe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},$e={},Ye={},Ze={INDEXEDDB:V,WEBSQL:De,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(Xe(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var st=function(){function e(t){for(var n in i(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],o=r._driver;this[n]=o,$e[o]||this.defineDriver(r)}this._defaultConfig=ot({},rt),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new u((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var o=nt.concat("_initStorage"),s=0,a=o.length;s<a;s++){var c=o[s];if((!ze(tt,c)||e[c])&&"function"!=typeof e[c])return void n(i)}var h=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=u.reject(t);return l(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var i=tt[n];e[i]||(e[i]=t(i))}};h();var f=function(n){$e[r]&&console.info("Redefining LocalForage driver: "+r),$e[r]=e,Ye[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(f,n):f(!!e._support):f(!0)}catch(e){n(e)}}));return h(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=$e[e]?u.resolve($e[e]):u.reject(new Error("Driver not found."));return h(r,t,n),r},e.prototype.getSerializer=function(e){var t=u.resolve(ye);return h(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return h(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;Xe(e)||(e=[e]);var i=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}function a(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(s).catch(n)}o();var a=new Error("No available storage method found.");return r._driverSet=u.reject(a),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return u.resolve()})):u.resolve();return this._driverSet=c.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=a(i)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=u.reject(e),r._driverSet})),h(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Ye[e]},e.prototype._extend=function(e){ot(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)it(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new st;t.exports=at},{3:3}]},{},[4])(4)})),Se=function(){function e(){_classCallCheck2(this,e),this.storageObjects=new Map}return _createClass(e,[{key:"createStorageObject",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localStorage";if(this.storageObjects.has(e))throw new Error("Could not create browser storage object - namespace ".concat(e," already exists"));switch(i){case"local":case"localStorage":t=be;break;default:throw new TypeError("invalid storage location string")}var o=function(n){return new Promise((function(r,i){t.getItem("".concat(e,".").concat(n),(function(e,t){e?i(e):r(JSON.parse(t))}))}))},s=function(n,r){return new Promise((function(i,o){t.setItem("".concat(e,".").concat(n),JSON.stringify(r),(function(e){e?o(e):i(null)}))}))},a=function(n){return new Promise((function(r,i){t.removeItem("".concat(e,".").concat(n),(function(e){e?i(e):r(null)}))}))},c=function(){return r(n,void 0,void 0,_regeneratorRuntime().mark((function n(){var r,i,o,s;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=[],n.next=3,t.length();case 3:i=n.sent,o=0;case 5:if(!(o<i)){n.next=13;break}return n.next=8,t.key(o);case 8:(s=n.sent).startsWith("".concat(e,"."))&&r.push(s);case 10:o++,n.next=5;break;case 13:return n.abrupt("return",Promise.all(r.map((function(e){return t.removeItem(e)}))));case 14:case"end":return n.stop()}}),n)})))},u={get:o,set:s,remove:a,clear:c};return this.storageObjects.set(e,u),u}},{key:"getStorageObject",value:function(e){return this.storageObjects.get("".concat(e))}}]),e}(),Ae=new Se,Re="token",_e="session",Oe=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,e.auth)).sessionExpiredListeners=[],r.storage=null,r.tokenPromise=null,r.lagToken=0,r.lagSession=0,r.cookieSession=!1,r.sessionExpiry=0,r.apiKey="",r.auth=_assertThisInitialized(r),r.serviceBrowserStorage=Ae,r.config=e,r.storage=r.BrowserStorage.createStorageObject("auth","localStorage"),r.initSessionExpired(),r}return _createClass(n,[{key:"BrowserStorage",get:function(){return this.serviceBrowserStorage}},{key:"setBaseUrlEndpoint",value:function(e){this.config.auth={url:e,urlToken:Te(e,"/tokens"),urlSession:Te(e,"/sessions")}}},{key:"getBaseUrlEndpoint",value:function(){return this.config.auth.url}},{key:"setSessionEndpoint",value:function(e){this.config.auth.urlSession=e}},{key:"getSessionEndpoint",value:function(){return this.config.auth.urlSession}},{key:"setTokenEndpoint",value:function(e){this.config.auth.urlToken=e}},{key:"getTokenEndpoint",value:function(){return this.config.auth.urlToken}},{key:"getTokenString",value:function(){return this.storage.get(Re)}},{key:"getToken",value:function(){var e=this;return this.getTokenString().then((function(t){var n=e.decodeToken(t);return n&&(n.exp*=1e3,n.iat*=1e3,n.msLeft=n.exp-(new Date).getTime()-e.lagToken),n}))}},{key:"isTokenValid",value:function(){return r(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getToken().catch((function(e){throw new Error("Failed to get token: ".concat(e))})).then((function(e){return!!(e&&e.msLeft>3e4)})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"validateToken",value:function(e){if("function"!=typeof e)return this._validateToken();this._validateToken().then(e)}},{key:"_validateToken",value:function(){return r(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isTokenValid().catch((function(e){return Promise.reject("Failed validate token: ".concat(e))})).then((function(e){return!!e||t.refreshToken()})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"refreshToken",value:function(e){if("function"!=typeof e)return this._refreshToken();this._refreshToken().then(e)}},{key:"_refreshToken",value:function(){return r(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.isSessionValid().then((function(e){return e?t.getSession():t.emitSessionExpired().then((function(){return Promise.reject("Session is invalid")}))})).then((function(e){return t.requestToken(e).then((function(){return!0})).catch((function(e){return Promise.reject("Failed to refresh token: ".concat(e))}))})));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"requestToken",value:function(e){var t=this;if(null!==this.tokenPromise)return this.tokenPromise;var n=this.apiKey?{"X-API-KEY":this.apiKey}:{sid:e.sid};return this.tokenPromise=this.request({path:this.config.auth.urlToken,method:"post",headers:n}).then((function(e){return r(t,void 0,void 0,_regeneratorRuntime().mark((function t(){var n=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.validateTokenResponse(e)){t.next=2;break}return t.abrupt("return",this.setToken(null).then((function(){throw new Error("MISSING_TOKEN_IN RESPONSE")})));case 2:return this.updateSessionExpiry(),t.abrupt("return",this.setToken(e.data).then((function(){return n.getToken()})));case 4:case"end":return t.stop()}}),t,this)})))})).catch((function(e){return Promise.reject(e)})).finally((function(){t.tokenPromise=null})),this.tokenPromise}},{key:"updateSessionExpiry",value:function(){var e=this;this.apiKey&&this.cookieSession||this.storage.get(_e).then((function(t){t&&(t.exp=e.sessionExpiry+Date.now(),e.setSessionObject(t))}))}},{key:"validateTokenResponse",value:function(e){return null!==e.data}},{key:"decodeToken",value:function(e){return e&&"string"==typeof e?JSON.parse(atob(e.split(".")[1])):null}},{key:"setToken",value:function(e){var t=this;return this.storage.set(Re,e).then((function(){return t.getToken()})).then((function(n){if(!n)return null;t.lagToken=null!==e?Date.now()-n.iat:null}))}},{key:"useSessionCookie",value:function(){this.cookieSession=!0}},{key:"getSession",value:function(){var e=this;return this.cookieSession||this.apiKey?Promise.resolve({exp:Date.now()+6e4,isSSO:!1,msLeft:6e4,sid:"",sid_core:null,sid_ngp:"",user:""}):this.storage.get(_e).then((function(t){return t&&(t.exp*=1e3,t.msLeft=t.exp-Date.now()-e.lagSession),Promise.resolve(t)}))}},{key:"isSessionValid",value:function(){return this.getSession().then((function(e){return Promise.resolve(!!(e&&Date.now()<e.exp))}))}},{key:"getTokenFromCredentials",value:function(e){var t=this;return e.token?(this.setToken(e.token).then((function(){return t.getToken()})),Promise.resolve(!0)):this.refreshToken()}},{key:"onAuthenticationRequired",value:function(e){return this.addSessionExpiredListener(e)}},{key:"addSessionExpiredListener",value:function(e){this.sessionExpiredListeners.push(e)}},{key:"removeSessionExpiredListener",value:function(e){this.sessionExpiredListeners=this.sessionExpiredListeners.filter((function(t){return t!==e}))}},{key:"emitSessionExpired",value:function(){var e=this;return this.getSession().then((function(t){return!!t&&e.setSessionObject(null).then((function(){return e.setToken(null)})).then((function(){return!0}))})).then((function(t){if(t){var n,r=_createForOfIteratorHelper(e.sessionExpiredListeners);try{for(r.s();!(n=r.n()).done;){(0,n.value)(!0)}}catch(e){r.e(e)}finally{r.f()}}}))}},{key:"initSessionExpired",value:function(){var e=this;ye.interceptors.response.use((function(e){return e}),(function(t){return t.response&&401===t.response.status&&t.request&&t.request.responseURL!==e.getSessionEndpoint()&&e.emitSessionExpired(),Promise.reject(t)}))}},{key:"login",value:function(e,t,n,r){if("function"!=typeof r)return this._login(e,t,n);this._login(e,t,n).then(r)}},{key:"_login",value:function(e,t,n){var r=this,i=this.config.auth;if(!i.url||!i.urlToken||!i.urlSession)throw new Error("MISSING BASEPATH CONFIG. Use config.setBasePath() to set the base path!");return this.requestSession(e,t,n).then((function(t){return r.createSession(t,e)})).then(this.getTokenFromCredentials.bind(this)).then((function(){return!0})).catch((function(e){var t,n=null===(t=e.response)||void 0===t?void 0:t.data;return 401===(null==n?void 0:n.code)&&n.changePassword,r.logout().then((function(){return!0})),Promise.reject(e)}))}},{key:"ssoLogin",value:function(e,t,n,r){if("function"!=typeof r)return this._ssoLogin(e,t,n);this._ssoLogin(e,t,n).then(r)}},{key:"_ssoLogin",value:function(e,t,n){var r=this;return this.request({path:"/sessions/trustedlogin?cipherToken=".concat(encodeURIComponent(e),"&hashToken=").concat(encodeURIComponent(t),"&authGroup=").concat(n),method:"get"}).then((function(e){return r.createSession(e,null,!0)})).then(this.getTokenFromCredentials.bind(this)).then((function(){return!0})).catch((function(e){return r.logout().then((function(){return!0})),Promise.reject(e)}))}},{key:"samlLogin",value:function(e,t){if("function"!=typeof t)return this._samlLogin(e);this._samlLogin(e).then(t)}},{key:"_samlLogin",value:function(e){var t=this;return e.startsWith("<")&&(e=btoa(e.replace(/\n/g,""))),e=encodeURIComponent(e),this.request({path:"".concat(this.config.auth.urlSession,"/samllogin"),method:"post",headers:{accept:"*/*","Content-Type":"application/x-www-form-urlencoded"},timeout:this.RequestTimeout,data:"SAMLResponse=".concat(e)}).then((function(e){return t.createSession(e,null,!0)})).then(this.getTokenFromCredentials.bind(this)).then((function(){return!0})).catch((function(e){return t.logout().then((function(){return!0})),Promise.reject(e)}))}},{key:"apiKeyLogin",value:function(e){return e?(this.apiKey=e,this.requestToken()):Promise.reject("MISSING APIKEY")}},{key:"createSession",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.validateSessionResponse(e)?(this.sessionExpiry=1e3*e.data.expiresAt-Date.now(),this.setSessionObject({user:t,isSSO:r,sid:e.data.sid,exp:e.data.expiresAt,sid_core:null,sid_ngp:null,msLeft:null,token:e.data.token}).then((function(){return n.getSession()}))):this.setSessionObject(null).then((function(){return Promise.reject("MISSING_SESSIONID_IN_RESPONSE")}))}},{key:"changePassword",value:function(e,t,n){if("function"!=typeof n)return this._changePassword(e,t);this._changePassword(e,t).then(n)}},{key:"_changePassword",value:function(e,t){var n=this.config.user.url+"/entities/logins/newpwd";return this.request({path:n,method:"put",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:this.RequestTimeout,data:{currentPassword:e,newPassword:t}}).then((function(){return!0})).catch((function(e){return Promise.reject(e)}))}},{key:"changePasswordFirstTime",value:function(e,t,n,r,i){if("function"!=typeof i)return this._changePasswordFirstTime(e,t,n,r);this._changePasswordFirstTime(e,t,n,r).then(i)}},{key:"_changePasswordFirstTime",value:function(e,t,n,r){var i=this,o=this.config.user.url+"/entities/logins/newpwdFirstTimeUser";return this.request({path:o,method:"put",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:this.RequestTimeout,data:{user:n,product:r,currentPassword:e,newPassword:t}}).then((function(e){return new Promise((function(t,r){i.validateSessionResponse(e)?i.setSessionObject({user:n,isSSO:!1,sid:e.data.sid,exp:e.data.expiresAt,sid_core:null,sid_ngp:null,msLeft:null}).then((function(){i.getSession().then((function(e){t(e)}))})):i.setSessionObject(null).then((function(){r("MISSING_SESSIONID_IN_RESPONSE")}))}))})).catch((function(e){return Promise.reject(e)}))}},{key:"logout",value:function(e){if("function"!=typeof e)return this._logout();this._logout().then(e)}},{key:"_logout",value:function(){var e=this;return this.getSession().then((function(t){return null===(null!==t?t.sid:null)?(e.logoutFinished(),Promise.resolve(!0)):e.request({path:e.config.auth.urlSession,method:"delete",headers:{Accept:"application/json","Content-Type":"application/json"},data:{sid:null==t?void 0:t.sid}}).then((function(t){return e.logoutFinished(),e.validateLogoutResponse(t)})).catch((function(){return e.logoutFinished(),Promise.resolve(!1)}))}))}},{key:"logoutFinished",value:function(){var e=this;return this.setToken(null).then((function(){return e.setSessionObject(null)}))}},{key:"requestSession",value:function(e,t,n){return this.request({path:this.config.auth.urlSession,method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},timeout:this.RequestTimeout,data:{user:e,password:t,product:n,fetchToken:!0}})}},{key:"validateSessionResponse",value:function(e){var t;return void 0!==(null===(t=e.data)||void 0===t?void 0:t.sid)}},{key:"validateLogoutResponse",value:function(e){return null!==e.data}},{key:"setSessionObject",value:function(e){return r(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.storage.set(_e,e).then((function(){n.lagSession=0})).catch((function(e){return e})));case 1:case"end":return t.stop()}}),t,this)})))}}]),n}(Ee),we=function(){function e(t,n){_classCallCheck2(this,e),this.serviceRest=n,this.path=t,this.running=!1}return _createClass(e,[{key:"Path",get:function(){return this.path},set:function(e){this.path=e}},{key:"restGenerator",value:_regeneratorRuntime().mark((function e(t,n){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.running){e.next=5;break}return e.next=3,this.serviceRest.get(this.path).catch(n).then(t);case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)}))},{key:"poll",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.running=!0;var i=this;return{get:function(o,s){var a=i.restGenerator((function(e){r&&!i.running||o(e)}),(function(e){t&&i.cancel(),s(e)}));n&&a.next(),i.id=window.setInterval((function(){a.next()}),e)}}}},{key:"cancel",value:function(){this.id&&(window.clearInterval(this.id),this.id=void 0,this.running=!1)}}]),e}(),Ie=function(){function e(t){_classCallCheck2(this,e),this.PollingMap={},this.serviceRest=t}return _createClass(e,[{key:"listActive",value:function(){return this.PollingMap}},{key:"cancel",value:function(e){if(!this.PollingMap[e])throw new Error("Unknown id '".concat(e,"'"));this.PollingMap[e].cancel(),delete this.PollingMap[e]}},{key:"cancelAll",value:function(){var e=this;Object.keys(this.PollingMap).forEach((function(t){return e.cancel(t)}))}},{key:"getId",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return this.PollingMap[t]?this.getId(e):t}},{key:"get",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e3,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];if(this.PollingMap[e])throw new Error("id must be unique. Id '".concat(e,"' is already in use"));this.PollingMap[e]=new we(t,this.serviceRest),this.PollingMap[e].poll(i,o,s,a).get(n,r)}}]),e}(),ke=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck2(this,n),(i=t.call(this,e.rest)).auth=r,i.config=e,i}return _createClass(n,[{key:"setUrlEndpoint",value:function(e){this.config.rest.url=e}},{key:"getUrlEndpoint",value:function(){return this.config.rest.url}}]),n}(Ee),Ne=t((function(t){e.crypto&&e.crypto.getRandomValues?t.exports.randomBytes=function(t){var n=new Uint8Array(t);return e.crypto.getRandomValues(n),n}:t.exports.randomBytes=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=Math.floor(256*Math.random());return t}}));Ne.randomBytes;var Ce="abcdefghijklmnopqrstuvwxyz012345",De={string:function(e){for(var t=Ce.length,n=Ne.randomBytes(e),r=[],i=0;i<e;i++)r.push(Ce.substr(n[i]%t,1));return r.join("")},number:function(e){return Math.floor(Math.random()*e)},numberString:function(e){var t=(""+(e-1)).length;return(new Array(t+1).join("0")+this.number(e)).slice(-t)}},Me=t((function(t){var n={},r=!1,i=e.chrome&&e.chrome.app&&e.chrome.app.runtime;t.exports={attachEvent:function(t,n){void 0!==e.addEventListener?e.addEventListener(t,n,!1):e.document&&e.attachEvent&&(e.document.attachEvent("on"+t,n),e.attachEvent("on"+t,n))},detachEvent:function(t,n){void 0!==e.addEventListener?e.removeEventListener(t,n,!1):e.document&&e.detachEvent&&(e.document.detachEvent("on"+t,n),e.detachEvent("on"+t,n))},unloadAdd:function(e){if(i)return null;var t=De.string(8);return n[t]=e,r&&setTimeout(this.triggerUnloadCallbacks,0),t},unloadDel:function(e){e in n&&delete n[e]},triggerUnloadCallbacks:function(){for(var e in n)n[e](),delete n[e]}};i||t.exports.attachEvent("unload",(function(){r||(r=!0,t.exports.triggerUnloadCallbacks())}))}));Me.attachEvent,Me.detachEvent,Me.unloadAdd,Me.unloadDel,Me.triggerUnloadCallbacks;var Ue=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e},Le=Object.prototype.hasOwnProperty;function Pe(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function xe(e){try{return encodeURIComponent(e)}catch(e){return null}}var je={stringify:function(e,t){t=t||"";var n,r,i=[];for(r in"string"!=typeof t&&(t="?"),e)if(Le.call(e,r)){if((n=e[r])||null!=n&&!isNaN(n)||(n=""),r=xe(r),n=xe(n),null===r||null===n)continue;i.push(r+"="+n)}return i.length?t+i.join("&"):""},parse:function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=Pe(t[1]),o=Pe(t[2]);null===i||null===o||i in r||(r[i]=o)}return r}},Be=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Ge=/[\n\r\t]/g,Ke=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Qe=/:\d+$/,Fe=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,qe=/^[a-zA-Z]:/;function He(e){return(e||"").toString().replace(Be,"")}var We=[["#","hash"],["?","query"],function(e,t){return ze(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],Ve={hash:1,query:1};function Je(t){var n,r=("undefined"!=typeof window?window:void 0!==e?e:"undefined"!=typeof self?self:{}).location||{},i={},o=_typeof2(t=t||r);if("blob:"===t.protocol)i=new $e(unescape(t.pathname),{});else if("string"===o)for(n in i=new $e(t,{}),Ve)delete i[n];else if("object"===o){for(n in t)n in Ve||(i[n]=t[n]);void 0===i.slashes&&(i.slashes=Ke.test(t.href))}return i}function ze(e){return"file:"===e||"ftp:"===e||"http:"===e||"https:"===e||"ws:"===e||"wss:"===e}function Xe(e,t){e=(e=He(e)).replace(Ge,""),t=t||{};var n,r=Fe.exec(e),i=r[1]?r[1].toLowerCase():"",o=!!r[2],s=!!r[3],a=0;return o?s?(n=r[2]+r[3]+r[4],a=r[2].length+r[3].length):(n=r[2]+r[4],a=r[2].length):s?(n=r[3]+r[4],a=r[3].length):n=r[4],"file:"===i?a>=2&&(n=n.slice(2)):ze(i)?n=r[4]:i?o&&(n=n.slice(2)):a>=2&&ze(t.protocol)&&(n=r[4]),{protocol:i,slashes:o||ze(i),slashesCount:a,rest:n}}function $e(e,t,n){if(e=(e=He(e)).replace(Ge,""),!(this instanceof $e))return new $e(e,t,n);var r,i,o,s,a,c,u=We.slice(),l=_typeof2(t),h=this,f=0;for("object"!==l&&"string"!==l&&(n=t,t=null),n&&"function"!=typeof n&&(n=je.parse),r=!(i=Xe(e||"",t=Je(t))).protocol&&!i.slashes,h.slashes=i.slashes||r&&t.slashes,h.protocol=i.protocol||t.protocol||"",e=i.rest,("file:"===i.protocol&&(2!==i.slashesCount||qe.test(e))||!i.slashes&&(i.protocol||i.slashesCount<2||!ze(h.protocol)))&&(u[3]=[/(.*)/,"pathname"]);f<u.length;f++)"function"!=typeof(s=u[f])?(o=s[0],c=s[1],o!=o?h[c]=e:"string"==typeof o?~(a="@"===o?e.lastIndexOf(o):e.indexOf(o))&&("number"==typeof s[2]?(h[c]=e.slice(0,a),e=e.slice(a+s[2])):(h[c]=e.slice(a),e=e.slice(0,a))):(a=o.exec(e))&&(h[c]=a[1],e=e.slice(0,a.index)),h[c]=h[c]||r&&s[3]&&t[c]||"",s[4]&&(h[c]=h[c].toLowerCase())):e=s(e,h);n&&(h.query=n(h.query)),r&&t.slashes&&"/"!==h.pathname.charAt(0)&&(""!==h.pathname||""!==t.pathname)&&(h.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],o=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(o=!0),n.splice(r,1),s--);return o&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(h.pathname,t.pathname)),"/"!==h.pathname.charAt(0)&&ze(h.protocol)&&(h.pathname="/"+h.pathname),Ue(h.port,h.protocol)||(h.host=h.hostname,h.port=""),h.username=h.password="",h.auth&&(~(a=h.auth.indexOf(":"))?(h.username=h.auth.slice(0,a),h.username=encodeURIComponent(decodeURIComponent(h.username)),h.password=h.auth.slice(a+1),h.password=encodeURIComponent(decodeURIComponent(h.password))):h.username=encodeURIComponent(decodeURIComponent(h.auth)),h.auth=h.password?h.username+":"+h.password:h.username),h.origin="file:"!==h.protocol&&ze(h.protocol)&&h.host?h.protocol+"//"+h.host:"null",h.href=h.toString()}$e.prototype={set:function(e,t,n){var r=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||je.parse)(t)),r[e]=t;break;case"port":r[e]=t,Ue(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,Qe.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(t){var i="pathname"===e?"/":"#";r[e]=t.charAt(0)!==i?i+t:t}else r[e]=t;break;case"username":case"password":r[e]=encodeURIComponent(t);break;case"auth":var o=t.indexOf(":");~o?(r.username=t.slice(0,o),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=t.slice(o+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(t))}for(var s=0;s<We.length;s++){var a=We[s];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&ze(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(e){e&&"function"==typeof e||(e=je.stringify);var t,n=this,r=n.host,i=n.protocol;i&&":"!==i.charAt(i.length-1)&&(i+=":");var o=i+(n.protocol&&n.slashes||ze(n.protocol)?"//":"");return n.username?(o+=n.username,n.password&&(o+=":"+n.password),o+="@"):n.password?(o+=":"+n.password,o+="@"):"file:"!==n.protocol&&ze(n.protocol)&&!r&&"/"!==n.pathname&&(o+="@"),(":"===r[r.length-1]||Qe.test(n.hostname)&&!n.port)&&(r+=":"),o+=r+n.pathname,(t="object"===_typeof2(n.query)?e(n.query):n.query)&&(o+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(o+=n.hash),o}},$e.extractProtocol=Xe,$e.location=Je,$e.trimLeft=He,$e.qs=je;var Ye=$e,Ze={getOrigin:function(e){if(!e)return null;var t=new Ye(e);if("file:"===t.protocol)return null;var n=t.port;return n||(n="https:"===t.protocol?"443":"80"),t.protocol+"//"+t.hostname+":"+n},isOriginEqual:function(e,t){return this.getOrigin(e)===this.getOrigin(t)},isSchemeEqual:function(e,t){return e.split(":")[0]===t.split(":")[0]},addPath:function(e,t){var n=e.split("?");return n[0]+t+(n[1]?"?"+n[1]:"")},addQuery:function(e,t){return e+(-1===e.indexOf("?")?"?"+t:"&"+t)},isLoopbackAddr:function(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^\[::1\]$/.test(e)}},et=t((function(e){"function"==typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}}));function tt(){this._listeners={}}tt.prototype.addEventListener=function(e,t){e in this._listeners||(this._listeners[e]=[]);var n=this._listeners[e];-1===n.indexOf(t)&&(n=n.concat([t])),this._listeners[e]=n},tt.prototype.removeEventListener=function(e,t){var n=this._listeners[e];if(n){var r=n.indexOf(t);-1===r||(n.length>1?this._listeners[e]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[e])}},tt.prototype.dispatchEvent=function(){var e=arguments[0],t=e.type,n=1===arguments.length?[e]:Array.apply(null,arguments);if(this["on"+t]&&this["on"+t].apply(this,n),t in this._listeners)for(var r=this._listeners[t],i=0;i<r.length;i++)r[i].apply(this,n)};var nt=tt;function rt(){nt.call(this)}et(rt,nt),rt.prototype.removeAllListeners=function(e){e?delete this._listeners[e]:this._listeners={}},rt.prototype.once=function(e,t){var n=this,r=!1;this.on(e,(function i(){n.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}))},rt.prototype.emit=function(){var e=arguments[0],t=this._listeners[e];if(t){for(var n=arguments.length,r=new Array(n-1),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0;o<t.length;o++)t[o].apply(this,r)}},rt.prototype.on=rt.prototype.addListener=nt.prototype.addEventListener,rt.prototype.removeListener=nt.prototype.removeEventListener;var it={EventEmitter:rt},ot=t((function(t){var n=e.WebSocket||e.MozWebSocket;t.exports=n?function(e){return new n(e)}:void 0})),st=it.EventEmitter;function at(e,t,n){if(!at.enabled())throw new Error("Transport created when disabled");st.call(this);var r=this,i=Ze.addPath(e,"/websocket");i="https"===i.slice(0,5)?"wss"+i.slice(5):"ws"+i.slice(4),this.url=i,this.ws=new ot(this.url,[],n),this.ws.onmessage=function(e){e.data,r.emit("message",e.data)},this.unloadRef=Me.unloadAdd((function(){r.ws.close()})),this.ws.onclose=function(e){e.code,e.reason,r.emit("close",e.code,e.reason),r._cleanup()},this.ws.onerror=function(e){r.emit("close",1006,"WebSocket connection broken"),r._cleanup()}}et(at,st),at.prototype.send=function(e){var t="["+e+"]";this.ws.send(t)},at.prototype.close=function(){var e=this.ws;this._cleanup(),e&&e.close()},at.prototype._cleanup=function(){var e=this.ws;e&&(e.onmessage=e.onclose=e.onerror=null),Me.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},at.enabled=function(){return!!ot},at.transportName="websocket",at.roundTrips=2;var ct=at,ut=it.EventEmitter;function lt(e,t){ut.call(this),this.sendBuffer=[],this.sender=t,this.url=e}et(lt,ut),lt.prototype.send=function(e){this.sendBuffer.push(e),this.sendStop||this.sendSchedule()},lt.prototype.sendScheduleWait=function(){var e,t=this;this.sendStop=function(){t.sendStop=null,clearTimeout(e)},e=setTimeout((function(){t.sendStop=null,t.sendSchedule()}),25)},lt.prototype.sendSchedule=function(){this.sendBuffer.length;var e=this;if(this.sendBuffer.length>0){var t="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,t,(function(t){e.sendStop=null,t?(e.emit("close",t.code||1006,"Sending error: "+t),e.close()):e.sendScheduleWait()})),this.sendBuffer=[]}},lt.prototype._cleanup=function(){this.removeAllListeners()},lt.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)};var ht=lt,ft=it.EventEmitter;function dt(e,t,n){ft.call(this),this.Receiver=e,this.receiveUrl=t,this.AjaxObject=n,this._scheduleReceiver()}et(dt,ft),dt.prototype._scheduleReceiver=function(){var e=this,t=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);t.on("message",(function(t){e.emit("message",t)})),t.once("close",(function(n,r){e.pollIsClosing,e.poll=t=null,e.pollIsClosing||("network"===r?e._scheduleReceiver():(e.emit("close",n||1006,r),e.removeAllListeners()))}))},dt.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()};var pt=dt;function vt(e,t,n,r,i){var o=Ze.addPath(e,t),s=this;ht.call(this,e,n),this.poll=new pt(r,o,i),this.poll.on("message",(function(e){s.emit("message",e)})),this.poll.once("close",(function(e,t){s.poll=null,s.emit("close",e,t),s.close()}))}et(vt,ht),vt.prototype.close=function(){ht.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)};var mt=vt;function yt(e,t,n,r){mt.call(this,e,t,function(e){return function(t,n,r){var i={};"string"==typeof n&&(i.headers={"Content-type":"text/plain"});var o=Ze.addPath(t,"/xhr_send"),s=new e("POST",o,n,i);return s.once("finish",(function(e){if(s=null,200!==e&&204!==e)return r(new Error("http status "+e));r()})),function(){s.close(),s=null;var e=new Error("Aborted");e.code=1e3,r(e)}}}(r),n,r)}et(yt,mt);var Et=yt,gt=it.EventEmitter;function Tt(e,t){gt.call(this);var n=this;this.bufferPosition=0,this.xo=new t("POST",e,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",(function(e,t){n._chunkHandler(e,t),n.xo=null;var r=200===e?"network":"permanent";n.emit("close",null,r),n._cleanup()}))}et(Tt,gt),Tt.prototype._chunkHandler=function(e,t){if(200===e&&t)for(var n=-1;;this.bufferPosition+=n+1){var r=t.slice(this.bufferPosition);if(-1===(n=r.indexOf("\n")))break;var i=r.slice(0,n);i&&this.emit("message",i)}},Tt.prototype._cleanup=function(){this.removeAllListeners()},Tt.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()};var bt=Tt,St=it.EventEmitter,At=e.XMLHttpRequest;function Rt(e,t,n,r){var i=this;St.call(this),setTimeout((function(){i._start(e,t,n,r)}),0)}et(Rt,St),Rt.prototype._start=function(e,t,n,r){var i=this;try{this.xhr=new At}catch(e){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();t=Ze.addQuery(t,"t="+ +new Date),this.unloadRef=Me.unloadAdd((function(){i._cleanup(!0)}));try{this.xhr.open(e,t,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){i.emit("finish",0,""),i._cleanup(!1)})}catch(e){return this.emit("finish",0,""),void this._cleanup(!1)}if(r&&r.noCredentials||!Rt.supportsCORS||(this.xhr.withCredentials=!0),r&&r.headers)for(var o in r.headers)this.xhr.setRequestHeader(o,r.headers[o]);this.xhr.onreadystatechange=function(){if(i.xhr){var e,t,n=i.xhr;switch(n.readyState,n.readyState){case 3:try{t=n.status,e=n.responseText}catch(e){}1223===t&&(t=204),200===t&&e&&e.length>0&&i.emit("chunk",t,e);break;case 4:1223===(t=n.status)&&(t=204),12005!==t&&12029!==t||(t=0),n.responseText,i.emit("finish",t,n.responseText),i._cleanup(!1)}}};try{i.xhr.send(n)}catch(e){i.emit("finish",0,""),i._cleanup(!1)}},Rt.prototype._cleanup=function(e){if(this.xhr){if(this.removeAllListeners(),Me.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),e)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},Rt.prototype.close=function(){this._cleanup(!0)},Rt.enabled=!!At;var _t=["Active"].concat("Object").join("X");!Rt.enabled&&_t in e&&(At=function(){try{return new e[_t]("Microsoft.XMLHTTP")}catch(e){return null}},Rt.enabled=!!new At);var Ot=!1;try{Ot="withCredentials"in new At}catch(e){}Rt.supportsCORS=Ot;var wt=Rt;function It(e,t,n,r){wt.call(this,e,t,n,r)}et(It,wt),It.enabled=wt.enabled&&wt.supportsCORS;var kt=It;function Nt(e,t,n){wt.call(this,e,t,n,{noCredentials:!0})}et(Nt,wt),Nt.enabled=wt.enabled;var Ct=Nt,Dt=function(){return e.navigator&&/opera/i.test(e.navigator.userAgent)},Mt=function(){return e.navigator&&/konqueror/i.test(e.navigator.userAgent)},Ut=function(){if(!e.document)return!0;try{return!!e.document.domain}catch(e){return!1}};function Lt(e){if(!Ct.enabled&&!kt.enabled)throw new Error("Transport created when disabled");Et.call(this,e,"/xhr_streaming",bt,kt)}et(Lt,Et),Lt.enabled=function(e){return!e.nullOrigin&&(!Dt()&&kt.enabled)},Lt.transportName="xhr-streaming",Lt.roundTrips=2,Lt.needBody=!!e.document;var Pt=Lt,xt=it.EventEmitter;function jt(e,t,n){var r=this;xt.call(this),setTimeout((function(){r._start(e,t,n)}),0)}et(jt,xt),jt.prototype._start=function(t,n,r){var i=this,o=new e.XDomainRequest;n=Ze.addQuery(n,"t="+ +new Date),o.onerror=function(){i._error()},o.ontimeout=function(){i._error()},o.onprogress=function(){o.responseText,i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},this.xdr=o,this.unloadRef=Me.unloadAdd((function(){i._cleanup(!0)}));try{this.xdr.open(t,n),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(r)}catch(e){this._error()}},jt.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},jt.prototype._cleanup=function(e){if(this.xdr){if(this.removeAllListeners(),Me.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,e)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},jt.prototype.close=function(){this._cleanup(!0)},jt.enabled=!(!e.XDomainRequest||!Ut());var Bt=jt;function Gt(e){if(!Bt.enabled)throw new Error("Transport created when disabled");Et.call(this,e,"/xhr_streaming",bt,Bt)}et(Gt,Et),Gt.enabled=function(e){return!e.cookie_needed&&!e.nullOrigin&&(Bt.enabled&&e.sameScheme)},Gt.transportName="xdr-streaming",Gt.roundTrips=2;var Kt=Gt,Qt=e.EventSource,Ft=it.EventEmitter;function qt(e){Ft.call(this);var t=this,n=this.es=new Qt(e);n.onmessage=function(e){e.data,t.emit("message",decodeURI(e.data))},n.onerror=function(e){n.readyState;var r=2!==n.readyState?"network":"permanent";t._cleanup(),t._close(r)}}et(qt,Ft),qt.prototype.abort=function(){this._cleanup(),this._close("user")},qt.prototype._cleanup=function(){var e=this.es;e&&(e.onmessage=e.onerror=null,e.close(),this.es=null)},qt.prototype._close=function(e){var t=this;setTimeout((function(){t.emit("close",null,e),t.removeAllListeners()}),200)};var Ht=qt;function Wt(e){if(!Wt.enabled())throw new Error("Transport created when disabled");Et.call(this,e,"/eventsource",Ht,kt)}et(Wt,Et),Wt.enabled=function(){return!!Qt},Wt.transportName="eventsource",Wt.roundTrips=2;var Vt=Wt,Jt="1.6.1",zt=t((function(t){t.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){t.exports.WPrefix in e||(e[t.exports.WPrefix]={})},postMessage:function(n,r){e.parent!==e&&e.parent.postMessage(JSON.stringify({windowId:t.exports.currentWindowId,type:n,data:r||""}),"*")},createIframe:function(t,n){var r,i,o=e.document.createElement("iframe"),s=function(){clearTimeout(r);try{o.onload=null}catch(e){}o.onerror=null},a=function(){o&&(s(),setTimeout((function(){o&&o.parentNode.removeChild(o),o=null}),0),Me.unloadDel(i))},c=function(e){o&&(a(),n(e))};return o.src=t,o.style.display="none",o.style.position="absolute",o.onerror=function(){c("onerror")},o.onload=function(){clearTimeout(r),r=setTimeout((function(){c("onload timeout")}),2e3)},e.document.body.appendChild(o),r=setTimeout((function(){c("timeout")}),15e3),i=Me.unloadAdd(a),{post:function(e,t){setTimeout((function(){try{o&&o.contentWindow&&o.contentWindow.postMessage(e,t)}catch(e){}}),0)},cleanup:a,loaded:s}},createHtmlfile:function(n,r){var i,o,s,a=["Active"].concat("Object").join("X"),c=new e[a]("htmlfile"),u=function(){clearTimeout(i),s.onerror=null},l=function(){c&&(u(),Me.unloadDel(o),s.parentNode.removeChild(s),s=c=null,CollectGarbage())},h=function(e){c&&(l(),r(e))};c.open(),c.write('<html><script>document.domain="'+e.document.domain+'";<\/script></html>'),c.close(),c.parentWindow[t.exports.WPrefix]=e[t.exports.WPrefix];var f=c.createElement("div");return c.body.appendChild(f),s=c.createElement("iframe"),f.appendChild(s),s.src=n,s.onerror=function(){h("onerror")},i=setTimeout((function(){h("timeout")}),15e3),o=Me.unloadAdd(l),{post:function(e,t){try{setTimeout((function(){s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}),0)}catch(e){}},cleanup:l,loaded:u}}},t.exports.iframeEnabled=!1,e.document&&(t.exports.iframeEnabled=("function"==typeof e.postMessage||"object"===_typeof2(e.postMessage))&&!Mt())}));zt.WPrefix,zt.currentWindowId,zt.polluteGlobalNamespace,zt.postMessage,zt.createIframe,zt.createHtmlfile,zt.iframeEnabled;var Xt=it.EventEmitter;function $t(e,t,n){if(!$t.enabled())throw new Error("Transport created when disabled");Xt.call(this);var r=this;this.origin=Ze.getOrigin(n),this.baseUrl=n,this.transUrl=t,this.transport=e,this.windowId=De.string(8);var i=Ze.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=zt.createIframe(i,(function(e){r.emit("close",1006,"Unable to load an iframe ("+e+")"),r.close()})),this.onmessageCallback=this._message.bind(this),Me.attachEvent("message",this.onmessageCallback)}et($t,Xt),$t.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){Me.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(e){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},$t.prototype._message=function(e){if(e.data,!Ze.isOriginEqual(e.origin,this.origin))return e.origin,void this.origin;var t;try{t=JSON.parse(e.data)}catch(t){return void e.data}if(t.windowId!==this.windowId)return t.windowId,void this.windowId;switch(t.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([Jt,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",t.data);break;case"c":var n;try{n=JSON.parse(t.data)}catch(e){return void t.data}this.emit("close",n[0],n[1]),this.close()}},$t.prototype.postMessage=function(e,t){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:e,data:t||""}),this.origin)},$t.prototype.send=function(e){this.postMessage("m",e)},$t.enabled=function(){return zt.iframeEnabled},$t.transportName="iframe",$t.roundTrips=2;var Yt=$t,Zt={isObject:function(e){var t=_typeof2(e);return"function"===t||"object"===t&&!!e},extend:function(e){if(!this.isObject(e))return e;for(var t,n,r=1,i=arguments.length;r<i;r++)for(n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}},en=function(t){function n(e,n){Yt.call(this,t.transportName,e,n)}return et(n,Yt),n.enabled=function(n,r){if(!e.document)return!1;var i=Zt.extend({},r);return i.sameOrigin=!0,t.enabled(i)&&Yt.enabled()},n.transportName="iframe-"+t.transportName,n.needBody=!0,n.roundTrips=Yt.roundTrips+t.roundTrips-1,n.facadeTransport=t,n},tn=it.EventEmitter;function nn(t){tn.call(this);var n=this;zt.polluteGlobalNamespace(),this.id="a"+De.string(6),t=Ze.addQuery(t,"c="+decodeURIComponent(zt.WPrefix+"."+this.id)),nn.htmlfileEnabled;var r=nn.htmlfileEnabled?zt.createHtmlfile:zt.createIframe;e[zt.WPrefix][this.id]={start:function(){n.iframeObj.loaded()},message:function(e){n.emit("message",e)},stop:function(){n._cleanup(),n._close("network")}},this.iframeObj=r(t,(function(){n._cleanup(),n._close("permanent")}))}et(nn,tn),nn.prototype.abort=function(){this._cleanup(),this._close("user")},nn.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete e[zt.WPrefix][this.id]},nn.prototype._close=function(e){this.emit("close",null,e),this.removeAllListeners()},nn.htmlfileEnabled=!1;var rn=["Active"].concat("Object").join("X");if(rn in e)try{nn.htmlfileEnabled=!!new e[rn]("htmlfile")}catch(e){}nn.enabled=nn.htmlfileEnabled||zt.iframeEnabled;var on=nn;function sn(e){if(!on.enabled)throw new Error("Transport created when disabled");Et.call(this,e,"/htmlfile",on,Ct)}et(sn,Et),sn.enabled=function(e){return on.enabled&&e.sameOrigin},sn.transportName="htmlfile",sn.roundTrips=2;var an=sn;function cn(e){if(!Ct.enabled&&!kt.enabled)throw new Error("Transport created when disabled");Et.call(this,e,"/xhr",bt,kt)}et(cn,Et),cn.enabled=function(e){return!e.nullOrigin&&(!(!Ct.enabled||!e.sameOrigin)||kt.enabled)},cn.transportName="xhr-polling",cn.roundTrips=2;var un=cn;function ln(e){if(!Bt.enabled)throw new Error("Transport created when disabled");Et.call(this,e,"/xhr",bt,Bt)}et(ln,Et),ln.enabled=Kt.enabled,ln.transportName="xdr-polling",ln.roundTrips=2;var hn=ln,fn=it.EventEmitter;function dn(t){var n=this;fn.call(this),zt.polluteGlobalNamespace(),this.id="a"+De.string(6);var r=Ze.addQuery(t,"c="+encodeURIComponent(zt.WPrefix+"."+this.id));e[zt.WPrefix][this.id]=this._callback.bind(this),this._createScript(r),this.timeoutId=setTimeout((function(){n._abort(new Error("JSONP script loaded abnormally (timeout)"))}),dn.timeout)}et(dn,fn),dn.prototype.abort=function(){if(e[zt.WPrefix][this.id]){var t=new Error("JSONP user aborted read");t.code=1e3,this._abort(t)}},dn.timeout=35e3,dn.scriptErrorTimeout=1e3,dn.prototype._callback=function(e){this._cleanup(),this.aborting||(e&&this.emit("message",e),this.emit("close",null,"network"),this.removeAllListeners())},dn.prototype._abort=function(e){this._cleanup(),this.aborting=!0,this.emit("close",e.code,e.message),this.removeAllListeners()},dn.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete e[zt.WPrefix][this.id]},dn.prototype._scriptError=function(){var e=this;this.errorTimer||(this.errorTimer=setTimeout((function(){e.loadedOkay||e._abort(new Error("JSONP script loaded abnormally (onerror)"))}),dn.scriptErrorTimeout))},dn.prototype._createScript=function(t){var n,r=this,i=this.script=e.document.createElement("script");if(i.id="a"+De.string(8),i.src=t,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){r._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(i.readyState,/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){r.loadedOkay=!0;try{i.onclick()}catch(e){}}i&&r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},void 0===i.async&&e.document.attachEvent)if(Dt())(n=this.script2=e.document.createElement("script")).text="try{var a = document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=n.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(e){}i.async=!0}void 0!==i.async&&(i.async=!0);var o=e.document.getElementsByTagName("head")[0];o.insertBefore(i,o.firstChild),n&&o.insertBefore(n,o.firstChild)};var pn,vn,mn=dn;var yn=function(t,n,r){pn||((pn=e.document.createElement("form")).style.display="none",pn.style.position="absolute",pn.method="POST",pn.enctype="application/x-www-form-urlencoded",pn.acceptCharset="UTF-8",(vn=e.document.createElement("textarea")).name="d",pn.appendChild(vn),e.document.body.appendChild(pn));var i="a"+De.string(8);pn.target=i,pn.action=Ze.addQuery(Ze.addPath(t,"/jsonp_send"),"i="+i);var o=function(t){try{return e.document.createElement('<iframe name="'+t+'">')}catch(r){var n=e.document.createElement("iframe");return n.name=t,n}}(i);o.id=i,o.style.display="none",pn.appendChild(o);try{vn.value=n}catch(e){}pn.submit();var s=function(e){o.onerror&&(o.onreadystatechange=o.onerror=o.onload=null,setTimeout((function(){o.parentNode.removeChild(o),o=null}),500),vn.value="",r(e))};return o.onerror=function(){s()},o.onload=function(){s()},o.onreadystatechange=function(e){o.readyState,"complete"===o.readyState&&s()},function(){s(new Error("Aborted"))}};function En(e){if(!En.enabled())throw new Error("Transport created when disabled");mt.call(this,e,"/jsonp",yn,mn)}et(En,mt),En.enabled=function(){return!!e.document},En.transportName="jsonp-polling",En.roundTrips=1,En.needBody=!0;var gn,Tn=En,bn=[ct,Pt,Kt,Vt,en(Vt),an,en(an),un,hn,en(un),Tn],Sn=Array.prototype,An=Object.prototype,Rn=Function.prototype,_n=String.prototype,On=Sn.slice,wn=An.toString,In=function(e){return"[object Function]"===An.toString.call(e)},kn=function(e){return"[object String]"===wn.call(e)},Nn=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}();gn=Nn?function(e,t,n,r){!r&&t in e||Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,r){!r&&t in e||(e[t]=n)};var Cn=function(e,t,n){for(var r in t)An.hasOwnProperty.call(t,r)&&gn(e,r,t[r],n)},Dn=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return Object(e)};function Mn(e){var t=+e;return t!=t?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t}function Un(){}Cn(Rn,{bind:function(e){var t=this;if(!In(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n=On.call(arguments,1),r=function(){if(this instanceof a){var r=t.apply(this,n.concat(On.call(arguments)));return Object(r)===r?r:this}return t.apply(e,n.concat(On.call(arguments)))},i=Math.max(0,t.length-n.length),o=[],s=0;s<i;s++)o.push("$"+s);var a=Function("binder","return function ("+o.join(",")+"){ return binder.apply(this, arguments); }")(r);return t.prototype&&(Un.prototype=t.prototype,a.prototype=new Un,Un.prototype=null),a}}),Cn(Array,{isArray:function(e){return"[object Array]"===wn.call(e)}});var Ln,Pn,xn,jn=Object("a"),Bn="a"!==jn[0]||!(0 in jn);Cn(Sn,{forEach:function(e){var t=Dn(this),n=Bn&&kn(this)?this.split(""):t,r=arguments[1],i=-1,o=n.length>>>0;if(!In(e))throw new TypeError;for(;++i<o;)i in n&&e.call(r,n[i],i,t)}},(Ln=Sn.forEach,Pn=!0,xn=!0,Ln&&(Ln.call("foo",(function(e,t,n){"object"!==_typeof2(n)&&(Pn=!1)})),Ln.call([1],(function(){xn="string"==typeof this}),"x")),!(Ln&&Pn&&xn)));var Gn=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);Cn(Sn,{indexOf:function(e){var t=Bn&&kn(this)?this.split(""):Dn(this),n=t.length>>>0;if(!n)return-1;var r=0;for(arguments.length>1&&(r=Mn(arguments[1])),r=r>=0?r:Math.max(0,n+r);r<n;r++)if(r in t&&t[r]===e)return r;return-1}},Gn);var Kn,Qn=_n.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?(Kn=void 0===/()??/.exec("")[1],_n.split=function(e,t){var n=this;if(void 0===e&&0===t)return[];if("[object RegExp]"!==wn.call(e))return Qn.call(this,e,t);var r,i,o,s,a=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.extended?"x":"")+(e.sticky?"y":""),u=0;for(e=new RegExp(e.source,c+"g"),n+="",Kn||(r=new RegExp("^"+e.source+"$(?!\\s)",c)),t=void 0===t?-1>>>0:t>>>0;(i=e.exec(n))&&!((o=i.index+i[0].length)>u&&(a.push(n.slice(u,i.index)),!Kn&&i.length>1&&i[0].replace(r,(function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(i[e]=void 0)})),i.length>1&&i.index<n.length&&Sn.push.apply(a,i.slice(1)),s=i[0].length,u=o,a.length>=t));)e.lastIndex===i.index&&e.lastIndex++;return u===n.length?!s&&e.test("")||a.push(""):a.push(n.slice(u)),a.length>t?a.slice(0,t):a}):"0".split(void 0,0).length&&(_n.split=function(e,t){return void 0===e&&0===t?[]:Qn.call(this,e,t)});var Fn=_n.substr,qn="".substr&&"b"!=="0b".substr(-1);Cn(_n,{substr:function(e,t){return Fn.call(this,e<0&&(e=this.length+e)<0?0:e,t)}},qn);var Hn,Wn=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,Vn=function(e){var t=JSON.stringify(e);return Wn.lastIndex=0,Wn.test(t)?(Hn||(Hn=function(e){var t,n={},r=[];for(t=0;t<65536;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,(function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""})),e.lastIndex=0,n}(Wn)),t.replace(Wn,(function(e){return Hn[e]}))):t},Jn={};["log","debug","warn"].forEach((function(t){var n;try{n=e.console&&e.console[t]&&e.console[t].apply}catch(e){}Jn[t]=n?function(){return e.console[t].apply(e.console,arguments)}:"log"===t?function(){}:Jn.log}));var zn=Jn;function Xn(e){this.type=e}Xn.prototype.initEvent=function(e,t,n){return this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=+new Date,this},Xn.prototype.stopPropagation=function(){},Xn.prototype.preventDefault=function(){},Xn.CAPTURING_PHASE=1,Xn.AT_TARGET=2,Xn.BUBBLING_PHASE=3;var $n=Xn,Yn=e.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""};function Zn(){$n.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}et(Zn,$n);var er=Zn;function tr(e){$n.call(this),this.initEvent("message",!1,!1),this.data=e}et(tr,$n);var nr=tr,rr=it.EventEmitter;function ir(){var e=this;rr.call(this),this.to=setTimeout((function(){e.emit("finish",200,"{}")}),ir.timeout)}et(ir,rr),ir.prototype.close=function(){clearTimeout(this.to)},ir.timeout=2e3;var or=ir,sr=it.EventEmitter;function ar(e,t){sr.call(this);var n=this,r=+new Date;this.xo=new t("GET",e),this.xo.once("finish",(function(e,t){var i,o;if(200===e){if(o=+new Date-r,t)try{i=JSON.parse(t)}catch(e){}Zt.isObject(i)||(i={})}n.emit("finish",i,o),n.removeAllListeners()}))}et(ar,sr),ar.prototype.close=function(){this.removeAllListeners(),this.xo.close()};var cr=ar,ur=it.EventEmitter;function lr(e){var t=this;ur.call(this),this.ir=new cr(e,Ct),this.ir.once("finish",(function(e,n){t.ir=null,t.emit("message",JSON.stringify([e,n]))}))}et(lr,ur),lr.transportName="iframe-info-receiver",lr.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()};var hr=lr,fr=it.EventEmitter;function dr(t,n){var r=this;fr.call(this);var i=function(){var e=r.ifr=new Yt(hr.transportName,n,t);e.once("message",(function(e){if(e){var t;try{t=JSON.parse(e)}catch(e){return r.emit("finish"),void r.close()}var n=t[0],i=t[1];r.emit("finish",n,i)}r.close()})),e.once("close",(function(){r.emit("finish"),r.close()}))};e.document.body?i():Me.attachEvent("load",i)}et(dr,fr),dr.enabled=function(){return Yt.enabled()},dr.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null};var pr=dr,vr=it.EventEmitter;function mr(e,t){var n=this;vr.call(this),setTimeout((function(){n.doXhr(e,t)}),0)}et(mr,vr),mr._getReceiver=function(e,t,n){return n.sameOrigin?new cr(t,Ct):kt.enabled?new cr(t,kt):Bt.enabled&&n.sameScheme?new cr(t,Bt):pr.enabled()?new pr(e,t):new cr(t,or)},mr.prototype.doXhr=function(e,t){var n=this,r=Ze.addPath(e,"/info");this.xo=mr._getReceiver(e,r,t),this.timeoutRef=setTimeout((function(){n._cleanup(!1),n.emit("finish")}),mr.timeout),this.xo.once("finish",(function(e,t){n._cleanup(!0),n.emit("finish",e,t)}))},mr.prototype._cleanup=function(e){clearTimeout(this.timeoutRef),this.timeoutRef=null,!e&&this.xo&&this.xo.close(),this.xo=null},mr.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},mr.timeout=8e3;var yr=mr;function Er(e){this._transport=e,e.on("message",this._transportMessage.bind(this)),e.on("close",this._transportClose.bind(this))}Er.prototype._transportClose=function(e,t){zt.postMessage("c",JSON.stringify([e,t]))},Er.prototype._transportMessage=function(e){zt.postMessage("t",e)},Er.prototype._send=function(e){this._transport.send(e)},Er.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()};var gr,Tr=Er;function br(e,t,n){if(!(this instanceof br))return new br(e,t,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");nt.call(this),this.readyState=br.CONNECTING,this.extensions="",this.protocol="",(n=n||{}).protocols_whitelist&&zn.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports,this._transportOptions=n.transportOptions||{},this._timeout=n.timeout||0;var r=n.sessionId||8;if("function"==typeof r)this._generateSessionId=r;else{if("number"!=typeof r)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return De.string(r)}}this._server=n.server||De.numberString(1e3);var i=new Ye(e);if(!i.host||!i.protocol)throw new SyntaxError("The URL '"+e+"' is invalid");if(i.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==i.protocol&&"https:"!==i.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+i.protocol+"' is not allowed.");var o="https:"===i.protocol;if("https:"===Yn.protocol&&!o&&!Ze.isLoopbackAddr(i.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");t?Array.isArray(t)||(t=[t]):t=[];var s=t.sort();s.forEach((function(e,t){if(!e)throw new SyntaxError("The protocols entry '"+e+"' is invalid.");if(t<s.length-1&&e===s[t+1])throw new SyntaxError("The protocols entry '"+e+"' is duplicated.")}));var a=Ze.getOrigin(Yn.href);this._origin=a?a.toLowerCase():null,i.set("pathname",i.pathname.replace(/\/+$/,"")),this.url=i.href,this.url,this._urlInfo={nullOrigin:!Ut(),sameOrigin:Ze.isOriginEqual(this.url,Yn.href),sameScheme:Ze.isSchemeEqual(this.url,Yn.href)},this._ir=new yr(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function Sr(e){return 1e3===e||e>=3e3&&e<=4999}et(br,nt),br.prototype.close=function(e,t){if(e&&!Sr(e))throw new Error("InvalidAccessError: Invalid code");if(t&&t.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==br.CLOSING&&this.readyState!==br.CLOSED){this._close(e||1e3,t||"Normal closure",!0)}},br.prototype.send=function(e){if("string"!=typeof e&&(e=""+e),this.readyState===br.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===br.OPEN&&this._transport.send(Vn(e))},br.version=Jt,br.CONNECTING=0,br.OPEN=1,br.CLOSING=2,br.CLOSED=3,br.prototype._receiveInfo=function(e,t){if(this._ir=null,e){this._rto=this.countRTO(t),this._transUrl=e.base_url?e.base_url:this.url,e=Zt.extend(e,this._urlInfo);var n=gr.filterToEnabled(this._transportsWhitelist,e);this._transports=n.main,this._transports.length,this._connect()}else this._close(1002,"Cannot connect to server")},br.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.transportName,t.needBody&&(!e.document.body||void 0!==e.document.readyState&&"complete"!==e.document.readyState&&"interactive"!==e.document.readyState))return this._transports.unshift(t),void Me.attachEvent("load",this._connect.bind(this));var n=Math.max(this._timeout,this._rto*t.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),n);var r=Ze.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=this._transportOptions[t.transportName],o=new t(r,this._transUrl,i);return o.on("message",this._transportMessage.bind(this)),o.once("close",this._transportClose.bind(this)),o.transportName=t.transportName,void(this._transport=o)}this._close(2e3,"All transports failed",!1)},br.prototype._transportTimeout=function(){this.readyState===br.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},br.prototype._transportMessage=function(e){var t,n=this,r=e.slice(0,1),i=e.slice(1);switch(r){case"o":return void this._open();case"h":return this.dispatchEvent(new $n("heartbeat")),void this.transport}if(i)try{t=JSON.parse(i)}catch(e){}if(void 0!==t)switch(r){case"a":Array.isArray(t)&&t.forEach((function(e){n.transport,n.dispatchEvent(new nr(e))}));break;case"m":this.transport,this.dispatchEvent(new nr(t));break;case"c":Array.isArray(t)&&2===t.length&&this._close(t[0],t[1],!0)}},br.prototype._transportClose=function(e,t){this.transport,this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),Sr(e)||2e3===e||this.readyState!==br.CONNECTING?this._close(e,t):this._connect()},br.prototype._open=function(){this._transport&&this._transport.transportName,this.readyState,this.readyState===br.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=br.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new $n("open")),this.transport):this._close(1006,"Server lost session")},br.prototype._close=function(e,t,n){this.transport,this.readyState;var r=!1;if(this._ir&&(r=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===br.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=br.CLOSING,setTimeout(function(){this.readyState=br.CLOSED,r&&this.dispatchEvent(new $n("error"));var i=new er;i.wasClean=n||!1,i.code=e||1e3,i.reason=t,this.dispatchEvent(i),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},br.prototype.countRTO=function(e){return e>100?4*e:300+e};var Ar,Rr=(gr=function(e){return{filterToEnabled:function(t,n){var r={main:[],facade:[]};return t?"string"==typeof t&&(t=[t]):t=[],e.forEach((function(e){e&&("websocket"===e.transportName&&!1===n.websocket||(t.length&&-1===t.indexOf(e.transportName)?e.transportName:e.enabled(n)?(e.transportName,r.main.push(e),e.facadeTransport&&r.facade.push(e.facadeTransport)):e.transportName))})),r}}}(Ar=bn),function(e,t){var n,r={};t.forEach((function(e){e.facadeTransport&&(r[e.facadeTransport.transportName]=e.facadeTransport)})),r[hr.transportName]=hr,e.bootstrap_iframe=function(){var t;zt.currentWindowId=Yn.hash.slice(1),Me.attachEvent("message",(function(i){if(i.source===parent&&(void 0===n&&(n=i.origin),i.origin===n)){var o;try{o=JSON.parse(i.data)}catch(e){return void i.data}if(o.windowId===zt.currentWindowId)switch(o.type){case"s":var s;try{s=JSON.parse(o.data)}catch(e){o.data;break}var a=s[0],c=s[1],u=s[2],l=s[3];if(a!==e.version)throw new Error('Incompatible SockJS! Main site uses: "'+a+'", the iframe: "'+e.version+'".');if(!Ze.isOriginEqual(u,Yn.href)||!Ze.isOriginEqual(l,Yn.href))throw new Error("Can't connect to different domain from within an iframe. ("+Yn.href+", "+u+", "+l+")");t=new Tr(new r[c](u,l));break;case"m":t._send(o.data);break;case"c":t&&t._close(),t=null}}})),zt.postMessage("s")}}(br,Ar),br);"_sockjs_onload"in e&&setTimeout(e._sockjs_onload,1);var _r,Or="https://dory.financial.com/",wr="dory.financial.com/",Ir={url:null},kr={url:null,urlSession:null,urlToken:null},Nr={url:null},Cr={url:null},Dr={sock_url:null,ws_url:null},Mr={sock_url:null,ws_url:null},Ur={level:-1};!function(e){e[e.DISABLED=-1]="DISABLED",e[e.CRITICAL=0]="CRITICAL",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.VERBOSE=4]="VERBOSE",e[e.SILLY=5]="SILLY"}(_r||(_r={}));var Lr,Pr={admin:Ir,auth:kr,rest:Cr,user:Nr,streaming:Dr,trading:Mr,logger:Ur,setBasePath:function(e){"/"===(e=e.trim()).slice(-1)&&(e=e.slice(0,-1)),wr=(Or=e).split("://")[1],Ir.url="".concat(Or,"/auth/api/v1/administration"),kr.url="".concat(Or,"/auth/api/v1"),kr.urlSession="".concat(Or,"/auth/api/v1/sessions"),kr.urlToken="".concat(Or,"/auth/api/v1/tokens"),Nr.url="".concat(Or,"/auth/api/v1/usersettings"),Cr.url="".concat(Or,"/rest/api"),Dr.sock_url="".concat(Or,"/streaming/streams"),Dr.ws_url="wss://".concat(wr,"/streaming/ticks"),Mr.sock_url="".concat(Or,"/trading/streams"),Mr.ws_url="wss://".concat(wr,"/trading/ticks")},setTradingPath:function(e){"/"===(e=e.trim()).slice(-1)&&(e=e.slice(0,-1));var t=e.split("://")[1];Mr.sock_url="".concat(e,"/trading/streams"),Mr.ws_url="wss://".concat(t,"/trading/ticks")},setConfigObject:function(e){Object.assign(Ir,e.admin),Object.assign(kr,e.auth),Object.assign(Nr,e.user),Object.assign(Cr,e.rest),Object.assign(Dr,e.streaming),Object.assign(Mr,e.trading),Object.assign(Ur,e.logger)}},xr=window;void 0!==xr.dory&&Pr.setConfigObject(xr.dory.config),function(e){e.AJAX="Ajax",e.AUTH="Auth",e.BROWSERSTORAGE="BrowserStorage",e.REST="Rest",e.RESTPOLLING="RestPolling",e.STREAMING="Streaming",e.STREAMING_MONITOR="Streaming Monitor",e.STREAMING_MARKETDEPTH="MarketDepth-Streaming",e.STREAMING_NEWS="News-Streaming",e.STREAMING_QUOTE="Quote-Streaming",e.STREAMING_MARKETDATA="MarketData-Streaming",e.STREAMING_QUOTETRADE="Quote-Trade",e.USERDATA="UserData"}(Lr||(Lr={}));var jr,Br=function(){function e(){_classCallCheck2(this,e)}return _createClass(e,[{key:"getCurrentTime",value:function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return String(e).padStart(t,"0")},t=new Date;return"".concat(e(t.getHours()),":").concat(e(t.getMinutes()),":").concat(e(t.getSeconds()),".").concat(e(t.getMilliseconds(),3))}},{key:"level",get:function(){return Ur.level}},{key:"critical",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.CRITICAL,e,n)}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.ERROR,e,n)}},{key:"warn",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.WARNING,e,n)}},{key:"info",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.INFO,e,n)}},{key:"verbose",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.VERBOSE,e,n)}},{key:"silly",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._log(_r.SILLY,e,n)}},{key:"_log",value:function(e,t,n){var r,i,o,s;if(e<=this.level){var a="[".concat(this.getCurrentTime()," - ").concat(t,"]");switch(e){case _r.CRITICAL:case _r.ERROR:(r=console).error.apply(r,[a].concat(_toConsumableArray(n)));break;case _r.WARNING:(i=console).warn.apply(i,[a].concat(_toConsumableArray(n)));break;case _r.INFO:(o=console).info.apply(o,[a].concat(_toConsumableArray(n)));break;case _r.VERBOSE:case _r.SILLY:(s=console).debug.apply(s,[a].concat(_toConsumableArray(n)))}}}}]),e}(),Gr=new Br;!function(e){e.SESSION_INVALID="SESSION_INVALID",e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTION_LOST="CONNECTION_LOST",e.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",e.SOCKET_UNAVAILABLE="SOCKET_UNAVAILABLE",e.TIMEOUT="TIMEOUT",e.REFRESH_TOKEN_FAILED="REFRESH_TOKEN_FAILED",e.INVALID_ID="INVALID_ID",e.INVALID_RIC="INVALID_RIC",e.INVALID_TOKEN="INVALID_TOKEN",e.INVALID_REQUEST="INVALID_REQUEST",e.MISSING_PARAMETERS="MISSING_PARAMETERS",e.UNKNOWN_STATUS="UNKNOWN_STATUS",e.UNKNOWN_MESSAGE="UNKNOWN_MESSAGE"}(jr||(jr={}));var Kr,Qr=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck2(this,n),(o=t.call(this,i)).source=e,o.status=r,o}return _createClass(n)}(),Fr=new Uint8Array(16);function qr(){if(!Kr&&!(Kr="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kr(Fr)}var Hr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Wr(e){return"string"==typeof e&&Hr.test(e)}for(var Vr=[],Jr=0;Jr<256;++Jr)Vr.push((Jr+256).toString(16).substr(1));function zr(e,t,n){var r=(e=e||{}).random||(e.rng||qr)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Vr[e[t+0]]+Vr[e[t+1]]+Vr[e[t+2]]+Vr[e[t+3]]+"-"+Vr[e[t+4]]+Vr[e[t+5]]+"-"+Vr[e[t+6]]+Vr[e[t+7]]+"-"+Vr[e[t+8]]+Vr[e[t+9]]+"-"+Vr[e[t+10]]+Vr[e[t+11]]+Vr[e[t+12]]+Vr[e[t+13]]+Vr[e[t+14]]+Vr[e[t+15]]).toLowerCase();if(!Wr(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var Xr,$r,Yr=new(function(){function e(){_classCallCheck2(this,e),this.listeners={},this.keys=[]}return _createClass(e,[{key:"on",value:function(e,t,n,r){var i=this,o=n;r&&(o=function(e){r(e)&&n(e)});var s=zr();return this.listeners[s]={service:e,messageType:t,callback:o},this.keys.push(s),function(){return i.unsubscribe(s)}}},{key:"once",value:function(e,t,n,r){var i=this.on(e,t,(function(e){r&&!r(e)||(n(e),i())}));return i}},{key:"all",value:function(e){var t=this,n=zr();return this.listeners[n]={callback:e},this.keys.push(n),function(){return t.unsubscribe(n)}}},{key:"unsubscribe",value:function(e){var t=this.keys.indexOf(e);-1!==t&&(delete this.listeners[e],this.keys.splice(t,1))}},{key:"emit",value:function(e,t,n){var r=this;this.keys.forEach((function(i){var o=r.listeners[i];void 0!==o.service&&o.service!==e||void 0!==o.messageType&&o.messageType!==t||o.callback(n)}))}}]),e}());!function(e){e.ALERT="alerts",e.MARKETDEPTH="marketdepth",e.NEWS="news",e.QUOTE="quotes",e.DEFAULT="streaming"}(Xr||(Xr={})),function(e){e.PING="ping",e.TOKENREFRESH="token-refresh",e.CANCEL="cancel",e.DSSTATUS="dsstatus",e.SNAPSHOT="snapshot",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.ADD="add",e.CHANGE="change",e.UPDATE="update",e.DELETE="delete"}($r||($r={}));var Zr=function(){function e(t,n,r){_classCallCheck2(this,e),this.NAMESPACE=t,this.SERVICENAME=n,this.SOCKET=r}return _createClass(e,[{key:"RaiseSocketUnavailableError",value:function(e,t){t&&t(void 0,new Qr(e,jr.SOCKET_UNAVAILABLE,"Can't send message, WebSocket Server is unavailable!"))}},{key:"RaiseNotConnectedError",value:function(e,t){t&&t(void 0,new Qr(e,jr.NOT_CONNECTED,"Can't send message, not connected to WebSocket Server!"))}},{key:"RaiseServiceUnavailableError",value:function(e,t){t&&t(void 0,new Qr(e,jr.SERVICE_UNAVAILABLE,"Can't send message, requested service is currently not available"))}},{key:"setTimeout",value:function(e,t,n){var r=window.setTimeout((function(){n(void 0,new Qr(e,jr.TIMEOUT,"Request to WebSocket timed out!"))}),t);return function(e,t){window.clearTimeout(r),n(e,t)}}},{key:"subscribeErrorHandler",value:function(e,t,n,r,i){if(!this.SOCKET.isServerAvailable)return this.RaiseSocketUnavailableError(e,t),!0;if(!this.SOCKET.isConnected)return this.RaiseNotConnectedError(e,t),!0;if(!this.isAvailable)return this.RaiseServiceUnavailableError(e,t),!0;if(r)t(void 0,new Qr(e,n?jr.INVALID_ID:jr.INVALID_REQUEST,n?"ID must be unique, ID ".concat(n," is already in use."):"Can't subscribe to Alert Streaming, already subscribed!"));else if(i)throw new Qr(e,jr.MISSING_PARAMETERS,i)}}]),e}();function ei(e){return{service:Xr.ALERT,messageType:e,version:"v1"}}var ti=function(){function e(t){_classCallCheck2(this,e),this.pending=[],this.id=t}return _createClass(e,[{key:"isPending",get:function(){return 0!==this.pending.length}},{key:"startTimeout",value:function(e,t,n){var r=this;this.pendingTimeout=window.setTimeout((function(){n(void 0,new Qr(t,jr.TIMEOUT,"Request to WebSocket timed out!")),r.stopTimeout()}),e)}},{key:"stopTimeout",value:function(){this.pendingTimeout&&(window.clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0)}}]),e}(),ni=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o,s;return _classCallCheck2(this,n),(s=t.call(this,e)).on=(_defineProperty(o={},$r.SUBSCRIBE,{handler:void 0,isAttached:!1,attach:function(){s.on[$r.SUBSCRIBE].isAttached=!0,s.on[$r.SUBSCRIBE].detach=Yr.once(Xr.ALERT,$r.SUBSCRIBE,(function(e){s.on[$r.SUBSCRIBE].handler(e,void 0),s.on[$r.SUBSCRIBE].isAttached=!1,s.stopTimeout()}))}}),_defineProperty(o,$r.UPDATE,{handler:void 0,isAttached:!1,attach:function(){s.on[$r.UPDATE].isAttached=!0,s.on[$r.UPDATE].detach=Yr.on(Xr.ALERT,$r.UPDATE,(function(e){s.on[$r.UPDATE].handler(e,void 0)}))}}),o),s.on[$r.SUBSCRIBE].handler=r,s.on[$r.UPDATE].handler=i,s}return _createClass(n,[{key:"subscribed",get:function(){return{}}},{key:"SubscribeRequest",get:function(){return{header:ei($r.SUBSCRIBE)}}},{key:"start",value:function(e){this.on[$r.SUBSCRIBE].attach(),this.on[$r.UPDATE].attach(),this.startTimeout(e,"Streaming.Alert.AlertSubscription.start",this.on[$r.SUBSCRIBE].handler)}},{key:"restart",value:function(e){this.on[$r.SUBSCRIBE].isAttached||this.on[$r.SUBSCRIBE].attach(),this.startTimeout(e,"Streaming.Alert.AlertSubscription.restart",this.on[$r.SUBSCRIBE].handler)}},{key:"stop",value:function(){this.on[$r.SUBSCRIBE].detach&&(this.on[$r.SUBSCRIBE].detach(),Gr.silly(Lr.STREAMING,"Detached Subscribe listener")),this.on[$r.UPDATE].detach&&(this.on[$r.UPDATE].detach(),Gr.silly(Lr.STREAMING,"Detached Update listener")),this.stopTimeout()}}]),n}(ti),ri=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,Xr.ALERT,"alerts",e)).available=!0,r.subscriptions=void 0,r}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){e&&!this.available?(this.available=e,this.resubscribe()):this.available=e}},{key:"subscribe",value:function(e,t){var n=void 0===e||void 0===t?'Missing required callback, "subscribe" requires callbacks for: \n- subscribe(data, error)\n- update(data, error)':"";if(this.subscribeErrorHandler("Streaming.Alert.subscribe",e,void 0,void 0!==this.subscriptions,n));else{var r=new ni("",e,t);this.subscriptions=r,r.start(this.SOCKET.Timeout),this.SOCKET.send(r.SubscribeRequest)}}},{key:"unsubscribe",value:function(e){var t="Streaming.Alert.unsubscribe";if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected)if(this.subscriptions){var n={header:ei($r.UNSUBSCRIBE)};this.subscriptions.stop(),this.subscriptions=void 0,e&&Yr.once(Xr.ALERT,$r.UNSUBSCRIBE,this.setTimeout(t,this.SOCKET.Timeout,e)),this.SOCKET.send(n)}else e&&e(void 0,new Qr(t,jr.INVALID_REQUEST,"Not subscribed to Alert Streaming!"));else this.RaiseNotConnectedError(t,e);else this.RaiseSocketUnavailableError(t,e)}},{key:"resubscribe",value:function(){this.subscriptions&&(this.subscriptions.restart(this.SOCKET.Timeout),this.SOCKET.send(this.subscriptions.SubscribeRequest))}},{key:"clearSubscriptions",value:function(){this.subscriptions=void 0}}]),n}(Zr);function ii(e){return{header:{service:Xr.DEFAULT,messageType:$r.TOKENREFRESH,version:"v1"},payload:{token:e}}}function oi(){return{header:{service:Xr.DEFAULT,messageType:$r.CANCEL,version:"v1"},payload:{}}}var si=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck2(this,n),(i=t.call(this,Xr.DEFAULT,"streaming",e)).available=!0,i.serviceAuth=r,i}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){this.available=e}},{key:"ping",value:function(e){var t="Streaming.ping";if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected){var n={header:{service:Xr.DEFAULT,messageType:$r.PING,version:"v1"},payload:{}};e&&Yr.once(this.NAMESPACE,$r.PING,e),this.SOCKET.send(n)}else this.RaiseNotConnectedError(t,e);else this.RaiseSocketUnavailableError(t,e)}},{key:"refreshToken",value:function(e){var t=this,n="Streaming.refreshToken";this.SOCKET.isServerAvailable?this.SOCKET.isConnected?this.serviceAuth.refreshToken().then((function(){return r(t,void 0,void 0,_regeneratorRuntime().mark((function t(){var r,i,o;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.serviceAuth.getTokenString();case 2:r=t.sent,i=ii(r),e&&(o=function(t,r){r||200===t.payload.status||(r=new Qr(n,jr.REFRESH_TOKEN_FAILED,"WebSocket could not refresh Token")),e(t,r)},Yr.once(this.NAMESPACE,$r.TOKENREFRESH,this.setTimeout(n,this.SOCKET.Timeout,o))),this.SOCKET.send(i);case 6:case"end":return t.stop()}}),t,this)})))})):this.RaiseNotConnectedError(n,e):this.RaiseSocketUnavailableError(n,e)}}]),n}(Zr);function ai(e){return{service:Xr.MARKETDEPTH,messageType:e,version:"v1"}}var ci=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,s){var a,c;return _classCallCheck2(this,n),(c=t.call(this,e))._rics=[],c.on=(_defineProperty(a={},$r.SUBSCRIBE,{handler:void 0,isAttached:!1,attach:function(){c.on[$r.SUBSCRIBE].isAttached=!0,c.on[$r.SUBSCRIBE].detach=Yr.on(Xr.MARKETDEPTH,$r.SUBSCRIBE,(function(e){var t=void 0;if(e.payload.subscription.failed.length>0){var n=e.payload.subscription.failed;t=new Qr("Streaming.MarketDepth.MarketDepthSubscription.onSubscribe",jr.INVALID_RIC,"Failed to subscribe to ".concat(n.length," out of ").concat(c._rics.length,' rics. Failed: "').concat(n,'".'))}c.on[$r.SUBSCRIBE].handler(e,t),c.stopTimeout()}),(function(e){return e.header.messageId===c.id}))}}),_defineProperty(a,$r.SNAPSHOT,{handler:void 0,isAttached:!1,attach:function(){c.on[$r.SNAPSHOT].isAttached=!0,c.on[$r.SNAPSHOT].detach=Yr.on(Xr.MARKETDEPTH,$r.SNAPSHOT,(function(e){Gr.silly(Lr.STREAMING_MARKETDEPTH,'Snapshot received for "'.concat(e.payload[0].ric,'"')),c.on[$r.SNAPSHOT].handler(e,void 0)}),(function(e){return e.header.messageId===c.id}))}}),_defineProperty(a,$r.UPDATE,{handler:void 0,isAttached:!1,attach:function(){c.on[$r.UPDATE].isAttached=!0,c.on[$r.UPDATE].detach=Yr.on(Xr.MARKETDEPTH,$r.UPDATE,(function(e){-1!==c._rics.indexOf(e.payload[0].ric)&&c.on[$r.UPDATE].handler(e,void 0)}))}}),a),c._rics=r,c.on[$r.SUBSCRIBE].handler=i,c.on[$r.SNAPSHOT].handler=o,c.on[$r.UPDATE].handler=s,c}return _createClass(n,[{key:"subscribed",get:function(){return{rics:this._rics}}},{key:"SubscribeRequest",get:function(){return e=this.id,t=[this.subscribed],{header:Object.assign(Object.assign({},ai($r.SUBSCRIBE)),{messageId:e}),payload:t};var e,t}},{key:"start",value:function(e){this.on[$r.SUBSCRIBE].attach(),this.on[$r.SNAPSHOT].attach(),this.on[$r.UPDATE].attach(),this.startTimeout(e,"Streaming.MarketDepth.MarketDepthSubscription.start",this.on[$r.SUBSCRIBE].handler)}},{key:"restart",value:function(e){this.startTimeout(e,"Streaming.MarketDepth.MarketDepthSubscription.restart",this.on[$r.SUBSCRIBE].handler)}},{key:"stop",value:function(){this.on[$r.SUBSCRIBE].detach&&(this.on[$r.SUBSCRIBE].detach(),Gr.silly(Lr.STREAMING_MARKETDEPTH,"Detached Subscribe listener")),this.on[$r.SNAPSHOT].detach&&(this.on[$r.SNAPSHOT].detach(),Gr.silly(Lr.STREAMING_MARKETDEPTH,"Detached Snapshot listener")),this.on[$r.UPDATE].detach&&(this.on[$r.UPDATE].detach(),Gr.silly(Lr.STREAMING_MARKETDEPTH,"Detached Update listener")),this.stopTimeout()}}]),n}(ti),ui=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,Xr.MARKETDEPTH,"quote",e)).available=!0,r.subscriptions={},r}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){e&&!this.available?(this.available=e,this.resubscribe()):this.available=e}},{key:"subscribe",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zr(),o="Streaming.MarketDepth.subscribe",s=void 0===t||void 0===n||void 0===r?'Missing required callback, "subscribe" requires callbacks for: \n- subscribe(data, error)\n- snapshot(data, error)\n- update(data, error)':"",a=this.subscribeErrorHandler(o,t,i,void 0!==this.subscriptions[i],s);if(!a){var c=new ci(i,e.rics,t,n,r);return this.subscriptions[i]=c,c.start(this.SOCKET.Timeout),this.SOCKET.send(c.SubscribeRequest),i}}},{key:"unsubscribe",value:function(e,t){var n="Streaming.MarketDepth.unsubscribe",r=this.subscriptions[e];this.SOCKET.isServerAvailable?this.SOCKET.isConnected?r?(r.stop(),delete this.subscriptions[e],this.unsubscribeRics(r.subscribed.rics,n,t)):t&&t(void 0,new Qr(n,jr.INVALID_ID,"No subscription for ID ".concat(e," registered!"))):this.RaiseNotConnectedError(n,t):this.RaiseSocketUnavailableError(n,t)}},{key:"unsubscribeAll",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){e.unsubscribe(t)}))}},{key:"resubscribe",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){var n=e.subscriptions[t];n.restart(e.SOCKET.Timeout),e.SOCKET.send(n.SubscribeRequest)}))}},{key:"unsubscribeRics",value:function(e,t,n){var r,i,o=this,s=(r=[]).concat.apply(r,_toConsumableArray(Object.keys(this.subscriptions).map((function(e){return o.subscriptions[e].subscribed.rics})))),a=e.filter((function(e){return-1===s.indexOf(e)})),c=ai($r.UNSUBSCRIBE);if(0!==a.length){var u=(i={rics:a},{header:ai($r.UNSUBSCRIBE),payload:[i]});n&&Yr.once(Xr.MARKETDEPTH,$r.UNSUBSCRIBE,this.setTimeout(t,this.SOCKET.Timeout,n)),this.SOCKET.send(u)}else n&&n({header:c,payload:{status:200,message:"Successfully un-subscribed."}})}},{key:"clearSubscriptions",value:function(){this.subscriptions={}}}]),n}(Zr);function li(e){return{service:Xr.NEWS,messageType:e,version:"v1"}}var hi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,s,a,c,u,l,h,f,d){var p,v;return _classCallCheck2(this,n),(v=t.call(this,e))._fids=[],v.on=(_defineProperty(p={},$r.SUBSCRIBE,{handler:void 0,isAttached:!1,attach:function(){v.on[$r.SUBSCRIBE].isAttached=!0,v.on[$r.SUBSCRIBE].detach=Yr.once(Xr.NEWS,$r.SUBSCRIBE,(function(e){var t=void 0;200!==e.payload.status&&(t=new Qr("Streaming.News.NewsSubscription.onSubscribe",jr.INVALID_REQUEST,"Failed to subscribe to news")),v.on[$r.SUBSCRIBE].handler(e,t),v.on[$r.SUBSCRIBE].isAttached=!1,v.stopTimeout()}),(function(e){return e.header.channelId===v.id}))}}),_defineProperty(p,$r.SNAPSHOT,{handler:void 0,isAttached:!1,attach:function(){v.on[$r.SNAPSHOT].isAttached=!0,v.on[$r.SNAPSHOT].detach=Yr.on(Xr.NEWS,$r.SNAPSHOT,(function(e){v.id===e.header.channelId&&v.on[$r.SNAPSHOT].handler(v.parseResponse(e),void 0)}))}}),_defineProperty(p,$r.ADD,{handler:void 0,isAttached:!1,attach:function(){v.on[$r.ADD].isAttached=!0,v.on[$r.ADD].detach=Yr.on(Xr.NEWS,$r.ADD,(function(e){v.id===e.header.channelId&&v.on[$r.ADD].handler(v.parseResponse(e),void 0)}))}}),_defineProperty(p,$r.CHANGE,{handler:void 0,isAttached:!1,attach:function(){v.on[$r.CHANGE].isAttached=!0,v.on[$r.CHANGE].detach=Yr.on(Xr.NEWS,$r.CHANGE,(function(e){v.id===e.header.channelId&&v.on[$r.CHANGE].handler(v.parseResponse(e),void 0)}))}}),_defineProperty(p,$r.DELETE,{handler:void 0,isAttached:!1,attach:function(){v.on[$r.DELETE].isAttached=!0,v.on[$r.DELETE].detach=Yr.on(Xr.NEWS,$r.DELETE,(function(e){v.id===e.header.channelId&&v.on[$r.DELETE].handler(v.parseResponse(e),void 0)}))}}),p),v._fids=r,v._timezone=i,v._history=o,v._fromnumber=s,v._tonumber=a,v._filter=c,v.on[$r.SUBSCRIBE].handler=u,v.on[$r.SNAPSHOT].handler=l,v.on[$r.ADD].handler=h,v.on[$r.CHANGE].handler=f,v.on[$r.DELETE].handler=d,v}return _createClass(n,[{key:"subscribed",get:function(){return{fids:this._fids,timezone:this._timezone,history:this._history,fromnumber:this._fromnumber,tonumber:this._tonumber,filter:this._filter}}},{key:"SubscribeRequest",get:function(){return e=this.id,t=[this.subscribed],{header:Object.assign(Object.assign({},li($r.SUBSCRIBE)),{channelId:e}),payload:t};var e,t}},{key:"start",value:function(e){this.on[$r.SUBSCRIBE].attach(),this.on[$r.SNAPSHOT].attach(),this.on[$r.ADD].attach(),this.on[$r.CHANGE].attach(),this.on[$r.DELETE].attach(),this.startTimeout(e,"Streaming.News.NewsSubscription.start",this.on[$r.SUBSCRIBE].handler)}},{key:"restart",value:function(e){this.on[$r.SUBSCRIBE].isAttached||this.on[$r.SUBSCRIBE].attach(),this.startTimeout(e,"Streaming.News.NewsSubscription.restart",this.on[$r.SUBSCRIBE].handler)}},{key:"stop",value:function(){this.on[$r.SUBSCRIBE].detach&&(this.on[$r.SUBSCRIBE].detach(),Gr.silly(Lr.STREAMING_NEWS,"Detached Subscribe listener")),this.on[$r.SNAPSHOT].detach&&(this.on[$r.SNAPSHOT].detach(),Gr.silly(Lr.STREAMING_NEWS,"Detached Snapshot listener")),this.on[$r.ADD].detach&&(this.on[$r.ADD].detach(),Gr.silly(Lr.STREAMING_NEWS,"Detached Add listener")),this.on[$r.CHANGE].detach&&(this.on[$r.CHANGE].detach(),Gr.silly(Lr.STREAMING_NEWS,"Detached Change listener")),this.on[$r.DELETE].detach&&(this.on[$r.DELETE].detach(),Gr.silly(Lr.STREAMING_NEWS,"Detached Delete listener")),this.stopTimeout()}},{key:"parseResponse",value:function(e){var t=e.payload[0].fids,n=e.payload[0].value.map((function(e){for(var n={},r=0;r<t.length;r++)n[t[r]]=e[r];return n}));return{header:e.header,payload:{fids:t,news:n}}}}]),n}(ti),fi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,Xr.NEWS,"news",e)).available=!0,r.subscriptions={},r}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){e&&!this.available?(this.available=e,this.resubscribe()):this.available=e}},{key:"subscribe",value:function(e,t,n,r,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:zr(),a="Streaming.News.subscribe",c=void 0===t||void 0===n||void 0===r||void 0===i||void 0===o?'Missing required callback, "subscribe" requires callbacks for: \n- subscribe(data, error)\n- add(data, error)\n- change(data, error)\n- snapshot(data, error)\n- remove(data, error)':"",u=this.subscribeErrorHandler(a,t,s,void 0!==this.subscriptions[s],c);if(!u){var l=new hi(s,e.fids,e.timezone,e.history,e.fromnumber,e.tonumber,e.filter,t,i,n,r,o);return this.subscriptions[s]=l,l.start(this.SOCKET.Timeout),this.SOCKET.send(l.SubscribeRequest),s}}},{key:"unsubscribe",value:function(e,t){var n,r="Streaming.News.unsubscribe",i=this.subscriptions[e];if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected)if(i){var o=(n=e,{header:Object.assign(Object.assign({},li($r.UNSUBSCRIBE)),{channelId:n}),payload:{}});i.stop(),delete this.subscriptions[e],t&&Yr.once(Xr.NEWS,$r.UNSUBSCRIBE,this.setTimeout(r,this.SOCKET.Timeout,t)),this.SOCKET.send(o)}else t&&t(void 0,new Qr(r,jr.INVALID_ID,"No subscription for ID ".concat(e," registered!")));else this.RaiseNotConnectedError(r,t);else this.RaiseSocketUnavailableError(r,t)}},{key:"unsubscribeAll",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){e.unsubscribe(t)}))}},{key:"resubscribe",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){var n=e.subscriptions[t];n.restart(e.SOCKET.Timeout),e.SOCKET.send(n.SubscribeRequest)}))}},{key:"clearSubscriptions",value:function(){this.subscriptions={}}}]),n}(Zr);function di(e){return{service:Xr.QUOTE,version:"v1",messageType:e}}var pi,vi,mi,yi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,s,a){var c,u;return _classCallCheck2(this,n),(u=t.call(this,e))._rics=[],u._fids=[],u.on=(_defineProperty(c={},$r.SUBSCRIBE,{handler:void 0,isAttached:!1,attach:function(){u.on[$r.SUBSCRIBE].isAttached=!0,u.on[$r.SUBSCRIBE].detach=Yr.once(Xr.QUOTE,$r.SUBSCRIBE,(function(e){var t=void 0;if(e.payload.subscription.failed.length>0){var n=e.payload.subscription.failed;t=new Qr("Streaming.Quote.QuoteSubscription.onSubscribe",jr.INVALID_RIC,"Failed to subscribe to ".concat(n.length," out of ").concat(u._rics.length,' rics. Failed: "').concat(n,'".'))}u.on[$r.SUBSCRIBE].handler(e,t),u.on[$r.SUBSCRIBE].isAttached=!1,u.stopTimeout()}),(function(e){return e.header.messageId===u.id}))}}),_defineProperty(c,$r.SNAPSHOT,{handler:void 0,isAttached:!1,attach:function(){u.on[$r.SNAPSHOT].isAttached=!0,u.on[$r.SNAPSHOT].detach=Yr.on(Xr.QUOTE,$r.SNAPSHOT,(function(e){var t;if(Gr.silly(Lr.STREAMING_QUOTE,"Snapshot received"),0!==e.payload[0].values.filter((function(e){return""!==e})).length&&(Gr.silly(Lr.STREAMING_QUOTE,"Snapshot not empty"),e.header.messageId===u.id||u.checkSnapshotBody(e))){Gr.silly(Lr.STREAMING_QUOTE,"Snapshot matches subscription");var n=u._fids.filter((function(t){return-1===e.payload[0].fids.indexOf(t)}));n.length>0&&Gr.warn(Lr.STREAMING_QUOTE,"Detected missing Fids (".concat(n,') in Snapshot for Ric "').concat(e.payload[0].ric," (Quote Subscription ").concat(u.id,')"'));var r=u.parseResponse(e),i=u.pending.indexOf(r.payload[0].ric);-1!==i&&(u.on[$r.SNAPSHOT].handler(u.parseResponse(e),void 0),u.pending.splice(i,1),Gr.silly(Lr.STREAMING_QUOTE,"Snapshot: removed ric from pending")),u.isPending||(null===(t=u.on[$r.SNAPSHOT])||void 0===t||t.detach(),u.on[$r.SNAPSHOT].detach=void 0,u.on[$r.SNAPSHOT].isAttached=!1,Gr.silly(Lr.STREAMING_QUOTE,"Snapshot handler stopped"))}}))}}),_defineProperty(c,$r.UPDATE,{handler:void 0,isAttached:!1,attach:function(){u.on[$r.UPDATE].isAttached=!0,u.on[$r.UPDATE].detach=Yr.on(Xr.QUOTE,$r.UPDATE,(function(e){-1!==u._rics.indexOf(e.payload[0].ric)&&u.on[$r.UPDATE].handler(u.parseResponse(e),void 0)}))}}),c),u._rics=r,u._fids=i,u.on[$r.SUBSCRIBE].handler=o,u.on[$r.SNAPSHOT].handler=s,u.on[$r.UPDATE].handler=a,u}return _createClass(n,[{key:"subscribed",get:function(){return{rics:this._rics,fids:this._fids}}},{key:"SubscribeRequest",get:function(){return e=this.id,t=[this.subscribed],{header:Object.assign(Object.assign({},di($r.SUBSCRIBE)),{messageId:e}),payload:t};var e,t}},{key:"start",value:function(e){this.pending=_toConsumableArray(this._rics),this.on[$r.SUBSCRIBE].attach(),this.on[$r.SNAPSHOT].attach(),this.on[$r.UPDATE].attach(),this.startTimeout(e,"Streaming.Quote.QuoteSubscription.start",this.on[$r.SUBSCRIBE].handler)}},{key:"restart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._rics;this.pending=_toConsumableArray(t),this.on[$r.SUBSCRIBE].isAttached||this.on[$r.SUBSCRIBE].attach(),this.on[$r.SNAPSHOT].isAttached||this.on[$r.SNAPSHOT].attach(),this.startTimeout(e,"Streaming.Quote.QuoteSubscription.restart",this.on[$r.SUBSCRIBE].handler)}},{key:"stop",value:function(){this.on[$r.SUBSCRIBE].detach&&(this.on[$r.SUBSCRIBE].detach(),Gr.silly(Lr.STREAMING_QUOTE,"Detached Subscribe listener")),this.on[$r.SNAPSHOT].detach&&(this.on[$r.SNAPSHOT].detach(),Gr.silly(Lr.STREAMING_QUOTE,"Detached Snapshot listener")),this.on[$r.UPDATE].detach&&(this.on[$r.UPDATE].detach(),Gr.silly(Lr.STREAMING_QUOTE,"Detached Update listener")),this.stopTimeout()}},{key:"addRics",value:function(e){var t=this;this._rics=this._rics.concat(e.filter((function(e){return!t._rics.includes(e)})))}},{key:"removeRics",value:function(e){var t,n=this,r=_createForOfIteratorHelper(e);try{var i=function(){var e=t.value,r=n._rics.findIndex((function(t){return t===e}));-1!==r&&n._rics.splice(r,1)};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}},{key:"addFids",value:function(e){var t=this;this._fids=this._fids.concat(e.filter((function(e){return!t._fids.includes(e)})))}},{key:"removeFids",value:function(e){var t,n=this,r=_createForOfIteratorHelper(e);try{var i=function(){var e=t.value,r=n._fids.findIndex((function(t){return t===e}));-1!==r&&n._fids.splice(r,1)};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}},{key:"parseResponse",value:function(e){var t=e.payload.map((function(e){for(var t={},n=0;n<e.fids.length;n++)t[e.fids[n]]=e.values[n];return{ric:e.ric,data:t}}));return{header:e.header,payload:t}}},{key:"checkSnapshotBody",value:function(e){return-1!==this._rics.indexOf(e.payload[0].ric)&&this._fids.every((function(t){return e.payload[0].fids.includes(t)}))}}]),n}(ti),Ei=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,Xr.QUOTE,"quote",e)).available=!0,r.subscriptions={},r}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){e&&!this.available?(this.available=e,this.resubscribe()):this.available=e}},{key:"subscribe",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zr(),o="Streaming.Quote.subscribe",s=void 0===t||void 0===n||void 0===r?'Missing required callback, "subscribe" requires callbacks for: \n- subscribe(data, error)\n- snapshot(data, error)\n- update(data, error)':"",a=this.subscribeErrorHandler(o,t,i,void 0!==this.subscriptions[i],s);if(!a){var c=new yi(i,e.rics,e.fids,t,n,r);return this.subscriptions[i]=c,c.start(this.SOCKET.Timeout),this.SOCKET.send(c.SubscribeRequest),i}}},{key:"unsubscribe",value:function(e,t){var n="Streaming.Quote.unsubscribe",r=this.subscriptions[e];this.SOCKET.isServerAvailable?this.SOCKET.isConnected?r?(r.stop(),delete this.subscriptions[e],this.unsubscribeRics(r.subscribed.rics,n,t)):t&&t(void 0,new Qr(n,jr.INVALID_ID,"No subscription for ID ".concat(e," registered!"))):this.RaiseNotConnectedError(n,t):this.RaiseSocketUnavailableError(n,t)}},{key:"unsubscribeAll",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){e.unsubscribe(t)}))}},{key:"addRics",value:function(e,t){var n=this.subscriptions[e];n.addRics(t),n.restart(this.SOCKET.Timeout,t),this.SOCKET.send(n.SubscribeRequest)}},{key:"removeRics",value:function(e,t){this.subscriptions[e].removeRics(t),this.unsubscribeRics(t,"Streaming.Quote.removeRics")}},{key:"addFids",value:function(e,t){var n=this.subscriptions[e];n.addFids(t),n.restart(this.SOCKET.Timeout),this.SOCKET.send(n.SubscribeRequest)}},{key:"removeFids",value:function(e,t){this.subscriptions[e].removeFids(t)}},{key:"resubscribe",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){var n=e.subscriptions[t];n.restart(e.SOCKET.Timeout),e.SOCKET.send(n.SubscribeRequest)}))}},{key:"unsubscribeRics",value:function(e,t,n){var r,i=this,o=(r=[]).concat.apply(r,_toConsumableArray(Object.keys(this.subscriptions).map((function(e){return i.subscriptions[e].subscribed.rics})))),s=e.filter((function(e){return-1===o.indexOf(e)})),a=di($r.UNSUBSCRIBE);if(0!==s.length){var c={header:a,payload:[{rics:s}]};n&&Yr.once(Xr.QUOTE,$r.UNSUBSCRIBE,this.setTimeout(t,this.SOCKET.Timeout,n)),this.SOCKET.send(c)}else n&&n({header:a,payload:{status:200,message:"Successfully un-subscribed."}})}},{key:"clearSubscriptions",value:function(){this.subscriptions={}}}]),n}(Zr),gi=function(){function e(t){_classCallCheck2(this,e),this.monitors={running:!1,sleep:void 0,websocket:void 0,status:void 0,internet:void 0},this.isVisibilityEventAttached=!1,this.disconnectListeners=[],this.visibilityListener=[],this.client=t}return _createClass(e,[{key:"Interval",get:function(){return this.interval},set:function(e){this.interval=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor interval is ".concat(e,"ms"))}},{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor timeout is ".concat(e,"ms"))}},{key:"RetryCount",get:function(){return this.retryCount},set:function(e){this.retryCount=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor retryCount is ".concat(e))}},{key:"SleepTolerance",get:function(){return this.sleepTolerance},set:function(e){this.sleepTolerance=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor sleepTolerance is ".concat(e))}},{key:"VisibilityTimeout",get:function(){return this.visibilityTimeout},set:function(e){this.visibilityTimeout=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor visibilityTimeout is ".concat(e))}},{key:"start",value:function(e){if(this.monitors.running)Gr.warn(Lr.STREAMING_MONITOR,"Did not start Streaming Monitor, monitor is already running");else{this.interval=e.interval||2500,this.timeout=e.timeout||1e3,this.retryCount=e.retryCount||2,this.sleepTolerance=e.sleepTolerance||5e3,this.visibilityTimeout=e.visibilityTimeout||1e4,this.monitors.running=!0,this.monitorSleep(),this.monitorWebsocket();for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.monitorStatus(n),this.monitorInternet(),this.client.isVisiblityMonitorEnabled&&(Gr.verbose(Lr.STREAMING_MONITOR,"Started screen visibility monitor"),this.monitorScreenVisibility()),Gr.info(Lr.STREAMING_MONITOR,"Started monitoring","\nInterval: ".concat(this.interval,"ms"),"\nTimeout: ".concat(this.timeout,"ms"),"\nRetryCount: ".concat(this.retryCount))}}},{key:"monitorScreenVisibility",value:function(){var e=this;if(!this.isVisibilityEventAttached){var t;document.addEventListener("visibilitychange",(function(){"visible"!==document.visibilityState?(Gr.warn(Lr.STREAMING_MONITOR,"visibility: Hidden"),t=setTimeout((function(){e.notifyVisibility(!0,!0)}),e.visibilityTimeout)):(clearTimeout(t),Gr.warn(Lr.STREAMING_MONITOR,"visibility: Visible"),e.notifyVisibility(!1))})),this.isVisibilityEventAttached=!0}}},{key:"monitorInternet",value:function(){Gr.verbose(Lr.STREAMING_MONITOR,"Started internet monitor");var e=function(e){Gr.warn(Lr.STREAMING_MONITOR,"Internet connection status (navigator.onLine) changed status to ".concat(e.type))};window.addEventListener("offline",e),window.addEventListener("online",e),this.monitors.internet=function(){window.removeEventListener("offline",e),window.removeEventListener("online",e)}}},{key:"monitorSleep",value:function(){var e=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started sleep monitor");var t=(new Date).getTime(),n=setInterval((function(){var n=(new Date).getTime();n>t+e.interval+e.sleepTolerance?(t=n,e.client.isServerAvailable||e.client.isConnected||(Gr.warn(Lr.STREAMING_MONITOR,"Sleep Monitor: Disconnected"),e.notify(new Qr("StreamingMonitor.monitorSleep",jr.CONNECTION_LOST,"Disconnected during sleep")))):t=n}),this.interval);this.monitors.sleep=function(){clearInterval(n)}}},{key:"monitorWebsocket",value:function(){var e=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started connection monitor");var t=!1,n=!0;this.monitors.websocket=Yr.all((function(){n&&(t=!0)})),Gr.silly(Lr.STREAMING_MONITOR,"Started EventBus listener");!function i(){e.monitors.running&&window.setTimeout((function(){return r(e,void 0,void 0,_regeneratorRuntime().mark((function e(){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t?(Gr.silly(Lr.STREAMING_MONITOR,"Traffic detected during inspection interval"),t=!1,i()):(Gr.silly(Lr.STREAMING_MONITOR,"No traffic detected during inspection interval"),Gr.silly(Lr.STREAMING_MONITOR,"Pause EventBus listener"),n=!1,this.sendPing().then((function(){r.monitors.running&&(Gr.silly(Lr.STREAMING_MONITOR,"Resume EventBus listener"),n=!0,i())})).catch((function(e){Gr.warn(Lr.STREAMING_MONITOR,"WebSocket Monitor: Disconnected"),r.notify(e)})));case 1:case"end":return e.stop()}}),e,this)})))}),e.interval)}()}},{key:"monitorStatus",value:function(e){var t=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started status monitor"),this.monitors.status=Yr.on(Xr.DEFAULT,$r.DSSTATUS,(function(n){Gr.verbose(Lr.STREAMING_MONITOR,"received status update"),t.updateStatus(e,n)})).bind(this)}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.monitors.running=!1,this.monitors.sleep&&(this.monitors.sleep(),this.monitors.sleep=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped sleep monitor")),this.monitors.websocket&&(this.monitors.websocket(),this.monitors.websocket=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped connection monitor")),this.monitors.status&&(this.monitors.status(),this.monitors.status=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped status monitor")),this.monitors.internet&&(this.monitors.internet(),this.monitors.internet=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped internet monitor")),Gr.verbose(Lr.STREAMING_MONITOR,"".concat(e?"Aborted":"Stopped"," monitoring"))}},{key:"sendPing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,r=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.monitors.running){t.next=2;break}return t.abrupt("return");case 2:return n=this.timeout*(e+1),Gr.verbose(Lr.STREAMING_MONITOR,"Send monitor ping ".concat(e+1," of ").concat(this.retryCount,", using ").concat(n,"ms timeout")),t.prev=4,t.next=7,new Promise((function(e,t){var i=setTimeout((function(){r.monitors.running&&t(new Qr("StreamingMonitor.sendPing",jr.TIMEOUT,"Received no message from WebSocket in ".concat(n,"ms!")))}),n),o=Date.now();r.client.ping((function(n,s){clearTimeout(i),r.monitors.running&&(s?t(new Qr("StreamingMonitor.sendPing",jr.TIMEOUT,"WebSocket ping response timed out!")):200!==n.payload.status?t(new Qr("StreamingMonitor.sendPing",jr.UNKNOWN_STATUS,"WebSocket responded with unknown status!")):"Ping successful."!==n.payload.message?t(new Qr("StreamingMonitor.sendPing",jr.UNKNOWN_MESSAGE,"WebSocket responded with unknown message!")):(Gr.silly(Lr.STREAMING_MONITOR,"received monitoring ping response in ".concat(Date.now()-o,"ms")),e()))}))}));case 7:t.next=17;break;case 9:if(t.prev=9,t.t0=t.catch(4),Gr.warn(Lr.STREAMING_MONITOR,t.t0),!(e+1<this.retryCount)){t.next=16;break}return t.abrupt("return",this.sendPing(e+1));case 16:return t.abrupt("return",Promise.reject(t.t0));case 17:case"end":return t.stop()}}),t,this,[[4,9]])})))}},{key:"updateStatus",value:function(e,t){var n=t.payload.status,r=[];if(e.forEach((function(e){var t;n[e.SERVICENAME]&&(e.isAvailable="available"===n[e.SERVICENAME],e.isAvailable||r.push((t=e.SERVICENAME,"".concat(t[0].toUpperCase()).concat(t.slice(1)))))})),r.length>0){var i=new Qr("StreamingMonitor.updateStatus",jr.SERVICE_UNAVAILABLE,"Following service".concat(1===r.length?" is":"s are"," no longer available:\n- ").concat(r.join("\n- ")));Gr.warn(Lr.STREAMING_MONITOR,i),this.notify(i,!1)}}},{key:"notify",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.stop(!0),Gr.warn(Lr.STREAMING_MONITOR,e);var n,r=_createForOfIteratorHelper(this.disconnectListeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;i(e)}}catch(e){r.e(e)}finally{r.f()}}},{key:"notifyVisibility",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&this.stop(!0);var n,r=_createForOfIteratorHelper(this.visibilityListener);try{for(r.s();!(n=r.n()).done;){var i=n.value;i(e)}}catch(e){r.e(e)}finally{r.f()}}},{key:"addDisconnectListener",value:function(e){this.disconnectListeners.push(e)}},{key:"removeDisconnectListener",value:function(e){this.disconnectListeners=this.disconnectListeners.filter((function(t){return t!==e}))}},{key:"addVisibilityListener",value:function(e){this.visibilityListener.push(e)}},{key:"removeVisibilityListener",value:function(e){this.visibilityListener=this.visibilityListener.filter((function(t){return t!==e}))}}]),e}(),Ti=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this.timeout=3e3,this.connected=!1,this.connectionLostListeners=[],this.connectionRestoredListeners=[],this.connectionPausedListeners=[],this.latency=0,this.serverAvailable=!0,this.visibilityMonitorEnabled=!1,this.serviceAuth=n,this.serviceAuth.addSessionExpiredListener((function(){r.isConnected&&r.disconnect()})),this.config=t,this.defaultStreaming=new si(this,this.serviceAuth),this.alertStreaming=new ri(this),this.marketDepthStreaming=new ui(this),this.newsStreaming=new fi(this),this.quoteStreaming=new Ei(this),this.streamingMonitor=new gi(this),this.streamingMonitor.addDisconnectListener((function(e){return r.connectionLost(e)})),this.streamingMonitor.addVisibilityListener(this.handleVisibilityChange.bind(this))}return _createClass(e,[{key:"Auth",get:function(){return this.serviceAuth}},{key:"setSockEndpoint",value:function(e){this.config.streaming.sock_url=e}},{key:"getSockEndpoint",value:function(){return this.config.streaming.sock_url}},{key:"setWebSocketEndpoint",value:function(e){this.config.streaming.ws_url=e}},{key:"getWebSocketEndpoint",value:function(){return this.config.streaming.ws_url}},{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e}},{key:"isConnected",get:function(){return this.connected}},{key:"Latency",get:function(){return this.latency}},{key:"isServerAvailable",get:function(){return this.serverAvailable}},{key:"isVisiblityMonitorEnabled",get:function(){return this.visibilityMonitorEnabled}},{key:"isServiceAvailable",get:function(){return{Alert:!!this.connected&&this.Alert.isAvailable,MarketDepth:!!this.connected&&this.MarketDepth.isAvailable,News:!!this.connected&&this.News.isAvailable,Quote:!!this.connected&&this.Quote.isAvailable}}},{key:"connect",value:function(e,t,n,i){return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this._connect(e,t,n,i,!1));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"_connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var s=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.visibilityMonitorEnabled=e.visibilityMonitorEnabled,!this.pendingConnect){r.next=3;break}return r.abrupt("return",this.pendingConnect);case 3:if(!this.connected){r.next=5;break}return r.abrupt("return",!0);case 5:if(this.isServerAvailable||o){r.next=7;break}throw new Qr("Streaming.connect",jr.SOCKET_UNAVAILABLE,"Socket not available");case 7:return this.pendingConnect=this.Auth.isSessionValid().then((function(e){if(!e)throw new Qr("Streaming.connect",jr.SESSION_INVALID,"Invalid Session");return s.Auth.refreshToken()})).catch((function(){throw s.pendingConnect=null,new Qr("Streaming.connect",jr.REFRESH_TOKEN_FAILED,"Could not refresh Token")})).then((function(){return s.Auth.getTokenString()})).then((function(r){return new Promise((function(o,a){var c=setTimeout((function(){s.pendingConnect=null,s.socket.close(),a(new Qr("Streaming.connect",jr.TIMEOUT,"WebSocket connect timed out! No response in ".concat(s.Timeout,"ms")))}),s.Timeout);Gr.silly(Lr.STREAMING,"Started connect timeout timer (id: ".concat(c,")")),s.socket=new Rr("".concat(s.getSockEndpoint(),"?jwt=").concat(r),null,e),s.socket.onopen=function(){Gr.info(Lr.STREAMING,"Connected to WebSocket"),s.connectOptions={options:e,error:t,connectionLost:n,connectionRestored:i},s.cancelTokenRefresh=setInterval((function(){return s.Auth.getToken().then((function(e){var t=e.exp;t-Date.now()<=6e4&&(s.refreshToken(),Gr.silly(Lr.STREAMING,"Requested new token, exp of current token ".concat(t-Date.now(),"ms")))}))}),1e4),Gr.silly(Lr.STREAMING,"Started Token refresh interval"),s.streamingMonitor.start(e.monitor||{},s.MarketDepth,s.News,s.Quote),clearTimeout(c),Gr.silly(Lr.STREAMING,"Stopped connect timeout timer (id: ".concat(c,")")),s.connected=!0,s.pendingConnect=null,o(!0)},s.socket.onclose=s.socketCloseHandler.bind(s),s.socket.onmessage=s.socketMessageHandler.bind(s),t&&(s.socket.onerror=t.bind(s))}))})),r.abrupt("return",this.pendingConnect);case 9:case"end":return r.stop()}}),r,this)})))}},{key:"disconnect",value:function(){var e=this;if(this.isConnected){var t=oi();return new Promise((function(n,r){var i=setTimeout((function(){r(new Qr("Streaming.disconnect",jr.TIMEOUT,"Websocket disconnect timed out!"))}),e.Timeout);e.socket.onclose=function(t){clearTimeout(i),e.quoteStreaming.clearSubscriptions(),e.newsStreaming.clearSubscriptions(),e.marketDepthStreaming.clearSubscriptions(),e.alertStreaming.clearSubscriptions(),e.socketCloseHandler(t),n(!0)},e.socket.send(JSON.stringify(t)),e.socket.close(1e3)}))}throw new Qr("Streaming.disconnect",jr.NOT_CONNECTED,"Can't disconnect, currently not connected to Socket.")}},{key:"reconnect",value:function(){var e=this;this.cancelReconnect||(this.cancelReconnect=setTimeout((function(){e.isConnected||(Gr.silly(Lr.STREAMING,"Starting reconnect attempt"),e._connect(e.connectOptions.options,e.connectOptions.error,e.connectOptions.connectionLost,e.connectOptions.connectionRestored,!0).then((function(t){if(e.serverAvailable=!0,t)return e.pingAsync(e.streamingMonitor.Timeout);throw new Error("Connect failed!")})).then((function(){Gr.error(Lr.STREAMING,"Connection to WebSocket restored!"),clearTimeout(e.cancelReconnect),e.cancelReconnect=null;var t,n=_createForOfIteratorHelper(e.connectionRestoredListeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(!0)}}catch(e){n.e(e)}finally{n.f()}e.connectOptions.connectionRestored&&e.connectOptions.connectionRestored(),e.Quote.resubscribe(),e.MarketDepth.resubscribe(),e.News.resubscribe(),e.Alert.resubscribe()})).catch((function(t){Gr.silly(Lr.STREAMING,"Reconnect attempt failed: ".concat(t)),e.cancelReconnect=null,e.serverAvailable=!1,e.reconnect()})))}),4e3))}},{key:"send",value:function(e){"string"==typeof e?this.socket.send(e):this.socket.send(JSON.stringify(e))}},{key:"addConnectionPausedListener",value:function(e){this.connectionPausedListeners.push(e)}},{key:"removeConnectionPausedListener",value:function(e){this.connectionPausedListeners=this.connectionPausedListeners.filter((function(t){return t!==e}))}},{key:"addConnectionLostListener",value:function(e){this.connectionLostListeners.push(e)}},{key:"removeConnectionLostListener",value:function(e){this.connectionLostListeners=this.connectionLostListeners.filter((function(t){return t!==e}))}},{key:"addConnectionRestoredListener",value:function(e){this.connectionRestoredListeners.push(e)}},{key:"removeConnectionRestoredListener",value:function(e){this.connectionRestoredListeners=this.connectionRestoredListeners.filter((function(t){return t!==e}))}},{key:"socketCloseHandler",value:function(e){this.cancelTokenRefresh&&clearInterval(this.cancelTokenRefresh),this.streamingMonitor.stop(),this.serverAvailable=!0,this.connected=!1,this.pendingConnect=void 0,!e||3e3!==e.code&&1006!==e.code||(this.serverAvailable=!1,Gr.error(Lr.STREAMING,"Connection to WebSocket closed! (".concat(e.code,")\n")),this.socket.close(),this.reconnect())}},{key:"socketMessageHandler",value:function(e){var t=JSON.parse(e.data),n=t.header;Yr.emit(n.service,n.messageType,t)}},{key:"connectionLost",value:function(e){if(e.status!==jr.SERVICE_UNAVAILABLE){Gr.error(Lr.STREAMING,"Connection to WebSocket lost!\n".concat(e.status)),this.serverAvailable=!1,this.socket.close();var t,n=_createForOfIteratorHelper(this.connectionLostListeners);try{for(n.s();!(t=n.n()).done;){(0,t.value)(!0)}}catch(e){n.e(e)}finally{n.f()}this.connectOptions.connectionLost&&this.connectOptions.connectionLost(e),this.reconnect()}else Gr.error(Lr.STREAMING,"Connection to Datasource lost!\n".concat(e.status,"\n").concat(JSON.stringify(this.isServiceAvailable,null,2)))}},{key:"ping",value:function(e){this.defaultStreaming.ping(e)}},{key:"pingAsync",value:function(e){var t=this;return new Promise((function(n,r){var i=setTimeout(r,e);t.ping((function(e,t){clearTimeout(i),t?r(t):n(e)}))}))}},{key:"refreshToken",value:function(e){var t=this,n=Date.now();this.defaultStreaming.refreshToken((function(r,i){t.latency=Date.now()-n,Gr.silly(Lr.STREAMING,"Refreshed token in ".concat(t.latency,"ms")),e&&e(r,i)}))}},{key:"Alert",get:function(){return this.alertStreaming}},{key:"MarketDepth",get:function(){return this.marketDepthStreaming}},{key:"News",get:function(){return this.newsStreaming}},{key:"Quote",get:function(){return this.quoteStreaming}},{key:"handleVisibilityChange",value:function(e){if(e){if(this.isConnected){Gr.warn(Lr.STREAMING,"Tab VisibilityChange: hidden, disconnecting socket");var t=oi();this.socket.send(JSON.stringify(t)),this.socket.close(1e3);var n,r=_createForOfIteratorHelper(this.connectionPausedListeners);try{for(r.s();!(n=r.n()).done;){(0,n.value)(!0)}}catch(e){r.e(e)}finally{r.f()}}}else this.isConnected||(Gr.warn(Lr.STREAMING,"Tab VisibilityChange: visable, reconnecting socket"),this.reconnect())}}]),e}();function bi(e){return{header:{service:pi.DEFAULT,messageType:vi.TOKENREFRESH,version:"v1"},payload:{token:e}}}!function(e){e.DEFAULT="streaming",e.MARKETDATA="fix-trades-ret",e.FIXTRADESRET="fix-trades-ret"}(pi||(pi={})),function(e){e.PING="ping",e.TOKENREFRESH="token-refresh",e.CANCEL="cancel",e.DSSTATUS="dsstatus",e.SNAPSHOT="snapshot",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.ADD="add",e.CHANGE="change",e.UPDATE="update",e.DELETE="delete",e.MARKETDATAREQUEST="marketdata-request",e.MARKETDATAREQUESTFAILED="request-failed",e.MARKETDATASNAPSHOT="marketdata-snapshot",e.MARKETDATAUPDATE="marketdata-update",e.FLOWTERMINATION="flow-termination",e.FLOWCANCELLATION="flow-cancellation",e.MARKETDATACANCELLATION="marketdata-cancellation",e.QUOTEREQUEST="quote-request",e.QUOTEREQUESTMESSAGE="quote-message",e.QUOTEREQUESTREJECT="request-failed",e.QUOTEREQUESTFAILED="request-failed",e.QUOTEREQUESTFLOWTERMINATION="flow-termination",e.QUOTEREQUESTCANCELLATION="quote-cancellation",e.QUOTEREJECT="quote-reject",e.QUOTEREJECTCONFIRMEND="flow-termination",e.QUOTEEXECUTION="trade-execution",e.QUOTEEXECUTIONREPORT="execution-report",e.POSTTRADEALLOCATIONREQUEST="pta-request",e.POSTTRADEALLOCATIONRESPONSE="pta-acknowledgement",e.POSTTRADEALLOCATIONTERMINATION="flow-termination"}(vi||(vi={})),function(e){e.SESSION_INVALID="SESSION_INVALID",e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTION_LOST="CONNECTION_LOST",e.SERVICE_UNAVAILABLE="SERVICE_UNAVAILABLE",e.SOCKET_UNAVAILABLE="SOCKET_UNAVAILABLE",e.TIMEOUT="TIMEOUT",e.REFRESH_TOKEN_FAILED="REFRESH_TOKEN_FAILED",e.INVALID_ID="INVALID_ID",e.INVALID_RIC="INVALID_RIC",e.INVALID_TOKEN="INVALID_TOKEN",e.INVALID_REQUEST="INVALID_REQUEST",e.MISSING_PARAMETERS="MISSING_PARAMETERS",e.UNKNOWN_STATUS="UNKNOWN_STATUS",e.UNKNOWN_MESSAGE="UNKNOWN_MESSAGE",e.QUOTE_TRADE_INVALID_STATE="QUOTE_TRADE_INVALID_STATE",e.QUOTE_TRADE_ALLOCATION_TERMINATION="QUOTE_TRADE_ALLOCATION_TERMINATION",e.QUOTE_REJECT="QUOTE_REJECT",e.QUOTE_REQUEST_REJECT="QUOTE_REQUEST_REJECT"}(mi||(mi={}));var Si=function(e){_inherits(n,_wrapNativeSuper(Error));var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck2(this,n),(o=t.call(this,i)).source=e,o.status=r,o}return _createClass(n)}(),Ai=new(function(){function e(){_classCallCheck2(this,e),this.listeners={},this.keys=[]}return _createClass(e,[{key:"on",value:function(e,t,n,r){var i=this,o=n;r&&(o=function(e){r(e)&&n(e)});var s=zr();return this.listeners[s]={service:e,messageType:t,callback:o},this.keys.push(s),function(){return i.unsubscribe(s)}}},{key:"once",value:function(e,t,n,r){var i=this.on(e,t,(function(e){r&&!r(e)||(n(e),i())}));return i}},{key:"all",value:function(e){var t=this,n=zr();return this.listeners[n]={callback:e},this.keys.push(n),function(){return t.unsubscribe(n)}}},{key:"unsubscribe",value:function(e){var t=this.keys.indexOf(e);-1!==t&&(delete this.listeners[e],this.keys.splice(t,1))}},{key:"emit",value:function(e,t,n){var r=this;this.keys.forEach((function(i){var o=r.listeners[i];void 0!==o.service&&o.service!==e||void 0!==o.messageType&&o.messageType!==t||o.callback(n)}))}}]),e}()),Ri=function(){function e(t,n,r){_classCallCheck2(this,e),this.NAMESPACE=t,this.SERVICENAME=n,this.SOCKET=r}return _createClass(e,[{key:"RaiseSocketUnavailableError",value:function(e,t){t&&t(void 0,new Si(e,mi.SOCKET_UNAVAILABLE,"Can't send message, WebSocket Server is unavailable!"))}},{key:"RaiseNotConnectedError",value:function(e,t){t&&t(void 0,new Si(e,mi.NOT_CONNECTED,"Can't send message, not connected to WebSocket Server!"))}},{key:"RaiseServiceUnavailableError",value:function(e,t){t&&t(void 0,new Si(e,mi.SERVICE_UNAVAILABLE,"Can't send message, requested service is currently not available"))}},{key:"setTimeout",value:function(e,t,n){var r=window.setTimeout((function(){n(void 0,new Si(e,mi.TIMEOUT,"Request to WebSocket timed out!"))}),t);return function(e,t){window.clearTimeout(r),n(e,t)}}},{key:"subscribeErrorHandler",value:function(e,t,n,r,i){if(!this.SOCKET.isServerAvailable)return this.RaiseSocketUnavailableError(e,t),!0;if(!this.SOCKET.isConnected)return this.RaiseNotConnectedError(e,t),!0;if(!this.isAvailable)return this.RaiseServiceUnavailableError(e,t),!0;if(r)t(void 0,new Si(e,n?mi.INVALID_ID:mi.INVALID_REQUEST,n?"ID must be unique, ID ".concat(n," is already in use."):"Can't subscribe to Alert Streaming, already subscribed!"));else if(i)throw new Si(e,mi.MISSING_PARAMETERS,i)}}]),e}(),_i=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck2(this,n),(i=t.call(this,pi.DEFAULT,"streaming",e)).available=!0,i.serviceAuth=r,i}return _createClass(n,[{key:"isAvailable",get:function(){return this.available},set:function(e){this.available=e}},{key:"ping",value:function(e){var t="Streaming.ping";if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected){var n={header:{service:pi.DEFAULT,messageType:vi.PING,version:"v1"},payload:{}};e&&Ai.once(this.NAMESPACE,vi.PING,e),this.SOCKET.send(n)}else this.RaiseNotConnectedError(t,e);else this.RaiseSocketUnavailableError(t,e)}},{key:"refreshToken",value:function(e){var t=this,n="Streaming.refreshToken";this.SOCKET.isServerAvailable?this.SOCKET.isConnected?this.serviceAuth.refreshToken().then((function(){return r(t,void 0,void 0,_regeneratorRuntime().mark((function t(){var r,i,o;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.serviceAuth.getTokenString();case 2:r=t.sent,i=bi(r),e&&(o=function(t,r){r||200===t.payload.status||(r=new Si(n,mi.REFRESH_TOKEN_FAILED,"WebSocket could not refresh Token")),e(t,r)},Ai.once(this.NAMESPACE,vi.TOKENREFRESH,this.setTimeout(n,this.SOCKET.Timeout,o))),this.SOCKET.send(i);case 6:case"end":return t.stop()}}),t,this)})))})):this.RaiseNotConnectedError(n,e):this.RaiseSocketUnavailableError(n,e)}}]),n}(Ri);function Oi(e){return{service:pi.MARKETDATA,version:"v1",messageType:e}}var wi,Ii=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,s,a,c){var u,l;return _classCallCheck2(this,n),(l=t.call(this,e)).on=(_defineProperty(u={},vi.MARKETDATAREQUEST,{handler:void 0,isAttached:!1,attach:function(){l.on[vi.MARKETDATAREQUEST].isAttached=!0,l.on[vi.MARKETDATAREQUEST].detach=Ai.once(pi.MARKETDATA,vi.MARKETDATAREQUESTFAILED,(function(e){var t=void 0;400===e.payload.status&&(t=new Si("Streaming.MarketData.MarketDataSubscription.onSubscribe",mi.INVALID_RIC,'Failed to subscribe symbol  "'.concat(l._symbol,'".'))),l.on[vi.MARKETDATAREQUEST].handler(e,t),l.on[vi.MARKETDATAREQUEST].isAttached=!1,l.stopTimeout()}),(function(e){return e.header.channelID===l.id}))}}),_defineProperty(u,vi.MARKETDATASNAPSHOT,{handler:void 0,isAttached:!1,attach:function(){l.on[vi.MARKETDATASNAPSHOT].isAttached=!0,l.on[vi.MARKETDATASNAPSHOT].detach=Ai.on(pi.MARKETDATA,vi.MARKETDATASNAPSHOT,(function(e){var t;if(Gr.silly(Lr.STREAMING_MARKETDATA,"Snapshot received"),l._symbol===e.payload.symbol){Gr.silly(Lr.STREAMING_MARKETDATA,"Snapshot matches subscription");var n=l.pending.indexOf(e.payload.symbol);-1!==n&&(l.on[vi.MARKETDATASNAPSHOT].handler(l.parseResponse(e),void 0),l.pending.splice(n,1),Gr.silly(Lr.STREAMING_MARKETDATA,"Snapshot: removed ric from pending")),l.isPending||(l.on[vi.MARKETDATAREQUEST].handler({header:Oi(vi.MARKETDATAREQUEST),payload:{status:200,message:"Successfully subscribed.",messageType:""}},void 0),l.on[vi.MARKETDATAREQUEST].isAttached=!1,l.stopTimeout(),null===(t=l.on[vi.MARKETDATASNAPSHOT])||void 0===t||t.detach(),l.on[vi.MARKETDATASNAPSHOT].detach=void 0,l.on[vi.MARKETDATASNAPSHOT].isAttached=!1,Gr.silly(Lr.STREAMING_MARKETDATA,"Snapshot handler stopped"))}}))}}),_defineProperty(u,vi.MARKETDATAUPDATE,{handler:void 0,isAttached:!1,attach:function(){l.on[vi.MARKETDATAUPDATE].isAttached=!0,l.on[vi.MARKETDATAUPDATE].detach=Ai.on(pi.MARKETDATA,vi.MARKETDATAUPDATE,(function(e){-1!==l._symbol.indexOf(e.payload.symbol)&&l.on[vi.MARKETDATAUPDATE].handler(l.parseResponse(e),void 0)}))}}),u),l._symbol=r,l._settlDate=o,l._tenor=i,l.on[vi.MARKETDATAREQUEST].handler=s,l.on[vi.MARKETDATASNAPSHOT].handler=a,l.on[vi.MARKETDATAUPDATE].handler=c,l}return _createClass(n,[{key:"subscribed",get:function(){return{symbol:this._symbol,tenor:this._tenor,settlDate:this._settlDate}}},{key:"SubscribeRequest",get:function(){return e=this.id,t=this.subscribed,{header:Object.assign(Object.assign({},Oi(vi.MARKETDATAREQUEST)),{channelID:e}),payload:t};var e,t}},{key:"start",value:function(e){this.pending=[this._symbol],this.on[vi.MARKETDATAREQUEST].attach(),this.on[vi.MARKETDATASNAPSHOT].attach(),this.on[vi.MARKETDATAUPDATE].attach(),this.startTimeout(e,"Streaming.MarketData.MarketDataSubscription.start",this.on[vi.MARKETDATAREQUEST].handler)}},{key:"restart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[this._symbol];this.pending=_toConsumableArray(t),this.on[vi.MARKETDATAREQUEST].isAttached||this.on[vi.MARKETDATAREQUEST].attach(),this.on[vi.MARKETDATASNAPSHOT].isAttached||this.on[vi.MARKETDATASNAPSHOT].attach(),this.startTimeout(e,"Streaming.MarketData.MarketDataSubscription.restart",this.on[vi.MARKETDATAREQUEST].handler)}},{key:"stop",value:function(){this.on[vi.MARKETDATAREQUEST].detach&&(this.on[vi.MARKETDATAREQUEST].detach(),Gr.silly(Lr.STREAMING_MARKETDATA,"Detached Subscribe listener")),this.on[vi.MARKETDATASNAPSHOT].detach&&(this.on[vi.MARKETDATASNAPSHOT].detach(),Gr.silly(Lr.STREAMING_MARKETDATA,"Detached Snapshot listener")),this.on[vi.MARKETDATAUPDATE].detach&&(this.on[vi.MARKETDATAUPDATE].detach(),Gr.silly(Lr.STREAMING_MARKETDATA,"Detached Update listener")),this.stopTimeout()}},{key:"parseResponse",value:function(e){for(var t={},n=0;n<e.payload.fids.length;n++)t[e.payload.fids[n]]=e.payload.values[n];return{header:e.header,payload:{symbol:e.payload.symbol,data:t}}}}]),n}(function(){function e(t){_classCallCheck2(this,e),this.pending=[],this.id=t}return _createClass(e,[{key:"isPending",get:function(){return 0!==this.pending.length}},{key:"startTimeout",value:function(e,t,n){var r=this;this.pendingTimeout=window.setTimeout((function(){n(void 0,new Si(t,mi.TIMEOUT,"Request to WebSocket timed out!")),r.stopTimeout()}),e)}},{key:"stopTimeout",value:function(){this.pendingTimeout&&(window.clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0)}}]),e}()),ki=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,pi.MARKETDATA,"market-data",e)).available=!0,r.timeout=15e3,r.subscriptions={},r}return _createClass(n,[{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e}},{key:"isAvailable",get:function(){return this.available},set:function(e){e&&!this.available?(this.available=e,this.resubscribe()):this.available=e}},{key:"subscribe",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zr(),o="Streaming.MarketData.subscribe",s=void 0===t||void 0===n||void 0===r?'Missing required callback, "subscribe" requires callbacks for: \n- subscribe(data, error)\n- snapshot(data, error)\n- update(data, error)':"",a=this.subscribeErrorHandler(o,t,i,void 0!==this.subscriptions[i],s);if(!a){var c=new Ii(i,e.symbol,e.tenor,e.settlDate,t,n,r);return this.subscriptions[i]=c,c.start(this.timeout),this.SOCKET.send(c.SubscribeRequest),i}}},{key:"unsubscribe",value:function(e,t){var n,r="Streaming.MarketData.unsubscribe",i=this.subscriptions[e];if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected)if(i){var o=(n=e,{header:Object.assign(Object.assign({},Oi(vi.MARKETDATACANCELLATION)),{channelID:n}),payload:null});i.stop(),delete this.subscriptions[e],t&&Ai.once(pi.MARKETDATA,vi.FLOWTERMINATION,this.setTimeout(r,this.SOCKET.Timeout,t)),this.SOCKET.send(o)}else t&&t(void 0,new Si(r,mi.INVALID_ID,"No subscription for ID ".concat(e," registered!")));else this.RaiseNotConnectedError(r,t);else this.RaiseSocketUnavailableError(r,t)}},{key:"unsubscribeAll",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){e.unsubscribe(t)}))}},{key:"resubscribe",value:function(){var e=this;Object.keys(this.subscriptions).forEach((function(t){var n=e.subscriptions[t];n.restart(e.SOCKET.Timeout),e.SOCKET.send(n.SubscribeRequest)}))}},{key:"clearSubscriptions",value:function(){this.subscriptions={}}}]),n}(Ri);function Ni(e){return{service:pi.FIXTRADESRET,version:"v1",messageType:e}}!function(e){e[e.PENDING=0]="PENDING",e[e.OFFER=1]="OFFER",e[e.ACCEPTED=2]="ACCEPTED",e[e.CANCELLED=3]="CANCELLED",e[e.REJECTED=4]="REJECTED"}(wi||(wi={}));var Ci=function(){function e(t,n){var r,i=this;_classCallCheck2(this,e),this.id=void 0,this.quoteId=void 0,this.on=(_defineProperty(r={},vi.QUOTEREQUESTMESSAGE,{handler:void 0,isAttached:!1,attach:function(){var e=Ai.on(pi.FIXTRADESRET,vi.QUOTEREQUESTMESSAGE,(function(e){var t;e.header.channelID===i.id&&(i.on[vi.QUOTEREQUESTMESSAGE].handler(e,void 0),i.quoteId=e.payload.quoteID,i._state=wi.OFFER,i.stopTimeout(),null===(t=i.on[vi.QUOTEREQUESTMESSAGE])||void 0===t||t.detach(),i.on[vi.QUOTEREQUESTMESSAGE].detach=void 0,i.on[vi.QUOTEREQUESTMESSAGE].isAttached=!1,Gr.silly(Lr.STREAMING_QUOTETRADE,"QuoteRequest Message handler stopped"))}));i.on[vi.QUOTEREQUESTMESSAGE].isAttached=!0,i.on[vi.QUOTEREQUESTMESSAGE].detach=e}}),_defineProperty(r,vi.QUOTEREQUESTREJECT,{handler:void 0,isAttached:!1,attach:function(){var e=function(e){e.header.channelID===i.id&&(i.on[vi.QUOTEREQUESTREJECT].handler(e,void 0),i._state=wi.REJECTED,i.stopTimeout(),i.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Request Reject, stopped all listeners for channel ".concat(i.id)))},t=Ai.on(pi.FIXTRADESRET,vi.QUOTEREQUESTFAILED,e),n=Ai.on(pi.FIXTRADESRET,vi.QUOTEREQUESTFLOWTERMINATION,e);i.on[vi.QUOTEREQUESTMESSAGE].isAttached=!0,i.on[vi.QUOTEREQUESTMESSAGE].detach=function(){t(),n()}}}),_defineProperty(r,vi.QUOTEREQUESTCANCELLATION,{handler:void 0,isAttached:!1,attach:function(){var e=Ai.on(pi.FIXTRADESRET,vi.QUOTEREQUESTCANCELLATION,(function(e){e.header.channelID!==i.id&&"Cancel All Quotes"!==e.payload.quoteCancelType||(i.on[vi.QUOTEREQUESTCANCELLATION].handler(e,void 0),i._state=wi.CANCELLED,i.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Cancellation, stopped all listeners for channel ".concat(i.id)))}));i.on[vi.QUOTEREQUESTCANCELLATION].isAttached=!0,i.on[vi.QUOTEREQUESTCANCELLATION].detach=e}}),_defineProperty(r,vi.QUOTEREJECTCONFIRMEND,{handler:void 0,isAttached:!1,attach:function(){var e=Ai.on(pi.FIXTRADESRET,vi.QUOTEREJECTCONFIRMEND,(function(e){e.header.channelID===i.id&&(i.on[vi.QUOTEREJECTCONFIRMEND].handler(e,void 0),i._state=wi.ACCEPTED,i.stopTimeout(),i.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Reject Confirmation, stopped all listeners for channel ".concat(i.id)))}));i.on[vi.QUOTEREJECTCONFIRMEND].isAttached=!0,i.on[vi.QUOTEREJECTCONFIRMEND].detach=e}}),_defineProperty(r,vi.QUOTEEXECUTIONREPORT,{handler:void 0,isAttached:!1,attach:function(){var e=0,t=Ai.on(pi.FIXTRADESRET,vi.QUOTEEXECUTIONREPORT,(function(t){t.header.channelID===i.id&&(i.on[vi.QUOTEEXECUTIONREPORT].handler(t,void 0),2===(e+=1)&&(i._state=wi.ACCEPTED,i.stopTimeout(),i.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Execution Report, stopped all listeners for channel ".concat(i.id))))}));i.on[vi.QUOTEEXECUTIONREPORT].isAttached=!0,i.on[vi.QUOTEEXECUTIONREPORT].detach=t}}),r),this.id=t,this.data=n,this._state=wi.PENDING}return _createClass(e,[{key:"state",get:function(){return this._state}},{key:"SubscribeRequest",get:function(){return{header:Object.assign(Object.assign({},Ni(vi.QUOTEREQUEST)),{channelID:this.id}),payload:this.data}}},{key:"RejectRequest",get:function(){return{header:Object.assign(Object.assign({},Ni(vi.QUOTEREJECT)),{channelID:this.id}),payload:{quoteID:this.quoteId,quoteRespType:"END_TRADE"}}}},{key:"ExecutionRequest",get:function(){return{header:Object.assign(Object.assign({},Ni(vi.QUOTEEXECUTION)),{channelID:this.id}),payload:{quoteId:this.quoteId}}}},{key:"request",value:function(e,t,n,r){this.on[vi.QUOTEREQUESTMESSAGE].handler=t,this.on[vi.QUOTEREQUESTREJECT].handler=n,this.on[vi.QUOTEREQUESTCANCELLATION].handler=r,this.on[vi.QUOTEREQUESTMESSAGE].attach(),this.on[vi.QUOTEREQUESTREJECT].attach(),this.on[vi.QUOTEREQUESTCANCELLATION].attach(),this.startTimeout(e,"Streaming.QuoteTrade.QuoteTradeSubscription.request",this.on[vi.QUOTEREQUESTREJECT].handler)}},{key:"reject",value:function(e,t){this.on[vi.QUOTEREJECTCONFIRMEND].handler=t,this.on[vi.QUOTEREJECTCONFIRMEND].attach(),this.startTimeout(e,"Streaming.QuoteTrade.QuoteTradeSubscription.reject",this.on[vi.QUOTEREJECTCONFIRMEND].handler)}},{key:"confirm",value:function(e,t){this.on[vi.QUOTEEXECUTIONREPORT].handler=t,this.on[vi.QUOTEEXECUTIONREPORT].attach(),this.startTimeout(e,"Streaming.QuoteTrade.QuoteTradeSubscription.confirm",this.on[vi.QUOTEEXECUTIONREPORT].handler)}},{key:"stop",value:function(){var e;for(var t in this.on)this.on[t].detach&&(null===(e=this.on[t])||void 0===e||e.detach(),this.on[t].detach=void 0,this.on[t].isAttached=!1,Gr.silly(Lr.STREAMING_QUOTETRADE,"Stopping ".concat(t," listener")));this.stopTimeout()}},{key:"startTimeout",value:function(e,t,n){var r=this;this.pendingTimeout=window.setTimeout((function(){n(void 0,new Si(t,mi.TIMEOUT,"Request to WebSocket timed out!")),r.stopTimeout()}),e)}},{key:"stopTimeout",value:function(){this.pendingTimeout&&(window.clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0)}}]),e}(),Di=function(){function e(t){var n,r=this;_classCallCheck2(this,e),this.id=void 0,this.on=(_defineProperty(n={},vi.POSTTRADEALLOCATIONRESPONSE,{handler:void 0,isAttached:!1,attach:function(){var e=0,t=Ai.on(pi.FIXTRADESRET,vi.POSTTRADEALLOCATIONRESPONSE,(function(t){r.on[vi.POSTTRADEALLOCATIONRESPONSE].handler(t,void 0),2===(e+=1)&&(r.stopTimeout(),r.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Post Trade allocation, stopped all listeners"))}));r.on[vi.POSTTRADEALLOCATIONRESPONSE].isAttached=!0,r.on[vi.POSTTRADEALLOCATIONRESPONSE].detach=t}}),_defineProperty(n,vi.POSTTRADEALLOCATIONTERMINATION,{handler:void 0,isAttached:!1,attach:function(){var e=Ai.on(pi.FIXTRADESRET,vi.POSTTRADEALLOCATIONTERMINATION,(function(e){r.on[vi.POSTTRADEALLOCATIONTERMINATION].handler(e,void 0),r.stopTimeout(),r.stop(),Gr.silly(Lr.STREAMING_QUOTETRADE,"Received Post Trade allocation Reject, stopped all listeners for channel ".concat(r.id))}));r.on[vi.POSTTRADEALLOCATIONTERMINATION].isAttached=!0,r.on[vi.POSTTRADEALLOCATIONTERMINATION].detach=e}}),n),this.id=t}return _createClass(e,[{key:"PostTradeAllocationRequest",get:function(){var e=this;return function(t){return{header:Object.assign(Object.assign({},Ni(vi.POSTTRADEALLOCATIONREQUEST)),{channelID:e.id}),payload:t}}}},{key:"allocate",value:function(e,t){var n="Streaming.QuoteTrade.QuoteTradeAllocationSubscription.PostTradeAllocation";this.on[vi.POSTTRADEALLOCATIONRESPONSE].handler=t,this.on[vi.POSTTRADEALLOCATIONRESPONSE].attach(),this.on[vi.POSTTRADEALLOCATIONTERMINATION].handler=function(e,r){t(void 0,r||new Si(n,mi.QUOTE_TRADE_ALLOCATION_TERMINATION,"Message Type: ".concat(e.payload.messageType,". \n Message : ").concat(e.payload.message,". \n Reason: ").concat(e.payload.reason)))},this.on[vi.POSTTRADEALLOCATIONTERMINATION].attach(),this.startTimeout(e,n,this.on[vi.POSTTRADEALLOCATIONRESPONSE].handler)}},{key:"stop",value:function(){var e;for(var t in this.on)this.on[t].detach&&(null===(e=this.on[t])||void 0===e||e.detach(),this.on[t].detach=void 0,this.on[t].isAttached=!1,Gr.silly(Lr.STREAMING_QUOTETRADE,"Stopping ".concat(t," listener")));this.stopTimeout()}},{key:"startTimeout",value:function(e,t,n){var r=this;this.pendingTimeout=window.setTimeout((function(){n(void 0,new Si(t,mi.TIMEOUT,"Request to WebSocket timed out!")),r.stopTimeout()}),e)}},{key:"stopTimeout",value:function(){this.pendingTimeout&&(window.clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0)}}]),e}(),Mi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck2(this,n),(r=t.call(this,pi.FIXTRADESRET,"quote-trade",e)).available=!0,r.timeout=15e3,r.subscriptions={},r}return _createClass(n,[{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e}},{key:"isAvailable",get:function(){return this.available},set:function(e){e&&this.available,this.available=e}},{key:"request",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:zr(),o="Streaming.QuoteTrade.request",s=void 0===t||void 0===n||void 0===r?'Missing required callback, "request" requires callbacks for: \n- message(data, error)\n- reject(data, error)\n- cancellation(data, error)':"",a=this.subscribeErrorHandler(o,n,i,void 0!==this.subscriptions[i],s);if(!a){var c=new Ci(i,e);return this.subscriptions[i]=c,c.request(this.timeout,t,n,r),this.SOCKET.send(c.SubscribeRequest),i}}},{key:"reject",value:function(e,t){var n="Streaming.QuoteTrade.reject",r=this.subscriptions[e];this.SOCKET.isServerAvailable?this.SOCKET.isConnected?r?r.state===wi.OFFER?(r.reject(this.timeout,t),this.SOCKET.send(r.RejectRequest),delete this.subscriptions[e]):t(null,new Si(n,mi.QUOTE_TRADE_INVALID_STATE,"Can't reject trade because there is no offer for this request")):t&&t(void 0,new Si(n,mi.INVALID_ID,"No request for ID ".concat(e," registered!"))):this.RaiseNotConnectedError(n,t):this.RaiseSocketUnavailableError(n,t)}},{key:"confirm",value:function(e,t){var n="Streaming.QuoteTrade.confirm",r=this.subscriptions[e];this.SOCKET.isServerAvailable?this.SOCKET.isConnected?r?r.state===wi.OFFER?(r.confirm(this.timeout,t),this.SOCKET.send(r.ExecutionRequest),delete this.subscriptions[e]):t(null,new Si(n,mi.QUOTE_TRADE_INVALID_STATE,"Can't confirm trade because there is no offer for this request")):t&&t(void 0,new Si(n,mi.INVALID_ID,"No request for ID ".concat(e," registered!"))):this.RaiseNotConnectedError(n,t):this.RaiseSocketUnavailableError(n,t)}},{key:"allocate",value:function(e,t){var n=zr(),r="Streaming.QuoteTrade.postTradeAllocation",i=void 0===t?'Missing required callback, "receive"':"";if(this.SOCKET.isServerAvailable)if(this.SOCKET.isConnected){if(i)throw new Si(r,mi.MISSING_PARAMETERS,i);var o=new Di(n);o.allocate(this.timeout,t),this.SOCKET.send(o.PostTradeAllocationRequest(e))}else this.RaiseNotConnectedError(r,t);else this.RaiseSocketUnavailableError(r,t)}},{key:"clearSubscriptions",value:function(){this.subscriptions={}}}]),n}(Ri),Ui=function(){function e(t){_classCallCheck2(this,e),this.monitors={running:!1,sleep:void 0,websocket:void 0,status:void 0,internet:void 0},this.disconnectListeners=[],this.client=t}return _createClass(e,[{key:"Interval",get:function(){return this.interval},set:function(e){this.interval=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor interval is ".concat(e,"ms"))}},{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor timeout is ".concat(e,"ms"))}},{key:"RetryCount",get:function(){return this.retryCount},set:function(e){this.retryCount=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor retryCount is ".concat(e))}},{key:"SleepTolerance",get:function(){return this.sleepTolerance},set:function(e){this.sleepTolerance=e,Gr.info(Lr.STREAMING_MONITOR,"new monitor sleepTolerance is ".concat(e))}},{key:"start",value:function(e){if(this.monitors.running)Gr.warn(Lr.STREAMING_MONITOR,"Did not start Streaming Monitor, monitor is already running");else{this.interval=e.interval||2500,this.timeout=e.timeout||1e3,this.retryCount=e.retryCount||2,this.sleepTolerance=e.sleepTolerance||5e3,this.monitors.running=!0,this.monitorSleep(),this.monitorWebsocket();for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.monitorStatus(n),this.monitorInternet(),Gr.info(Lr.STREAMING_MONITOR,"Started monitoring","\nInterval: ".concat(this.interval,"ms"),"\nTimeout: ".concat(this.timeout,"ms"),"\nRetryCount: ".concat(this.retryCount))}}},{key:"monitorInternet",value:function(){Gr.verbose(Lr.STREAMING_MONITOR,"Started internet monitor");var e=function(e){Gr.warn(Lr.STREAMING_MONITOR,"Internet connection status (navigator.onLine) changed status to ".concat(e.type))};window.addEventListener("offline",e),window.addEventListener("online",e),this.monitors.internet=function(){window.removeEventListener("offline",e),window.removeEventListener("online",e)}}},{key:"monitorSleep",value:function(){var e=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started sleep monitor");var t=(new Date).getTime(),n=setInterval((function(){var n=(new Date).getTime();n>t+e.interval+e.sleepTolerance?(t=n,e.client.isServerAvailable||e.client.isConnected||(Gr.warn(Lr.STREAMING_MONITOR,"Sleep Monitor: Disconnected"),e.notify(new Si("StreamingMonitor.monitorSleep",mi.CONNECTION_LOST,"Disconnected during sleep")))):t=n}),this.interval);this.monitors.sleep=function(){clearInterval(n)}}},{key:"monitorWebsocket",value:function(){var e=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started connection monitor");var t=!1,n=!0;this.monitors.websocket=Ai.all((function(){n&&(t=!0)})),Gr.silly(Lr.STREAMING_MONITOR,"Started EventBus listener");!function i(){e.monitors.running&&window.setTimeout((function(){return r(e,void 0,void 0,_regeneratorRuntime().mark((function e(){var r=this;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t?(Gr.silly(Lr.STREAMING_MONITOR,"Traffic detected during inspection interval"),t=!1,i()):(Gr.silly(Lr.STREAMING_MONITOR,"No traffic detected during inspection interval"),Gr.silly(Lr.STREAMING_MONITOR,"Pause EventBus listener"),n=!1,this.sendPing().then((function(){r.monitors.running&&(Gr.silly(Lr.STREAMING_MONITOR,"Resume EventBus listener"),n=!0,i())})).catch((function(e){Gr.warn(Lr.STREAMING_MONITOR,"WebSocket Monitor: Disconnected"),r.notify(e)})));case 1:case"end":return e.stop()}}),e,this)})))}),e.interval)}()}},{key:"monitorStatus",value:function(e){var t=this;Gr.verbose(Lr.STREAMING_MONITOR,"Started status monitor"),this.monitors.status=Ai.on(pi.DEFAULT,vi.DSSTATUS,(function(n){Gr.verbose(Lr.STREAMING_MONITOR,"received status update"),t.updateStatus(e,n)})).bind(this)}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.monitors.running=!1,this.monitors.sleep&&(this.monitors.sleep(),this.monitors.sleep=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped sleep monitor")),this.monitors.websocket&&(this.monitors.websocket(),this.monitors.websocket=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped connection monitor")),this.monitors.status&&(this.monitors.status(),this.monitors.status=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped status monitor")),this.monitors.internet&&(this.monitors.internet(),this.monitors.internet=void 0,Gr.verbose(Lr.STREAMING_MONITOR,"Stopped internet monitor")),Gr.verbose(Lr.STREAMING_MONITOR,"".concat(e?"Aborted":"Stopped"," monitoring"))}},{key:"sendPing",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,r=this;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.monitors.running){t.next=2;break}return t.abrupt("return");case 2:return n=this.timeout*(e+1),Gr.verbose(Lr.STREAMING_MONITOR,"Send monitor ping ".concat(e+1," of ").concat(this.retryCount,", using ").concat(n,"ms timeout")),t.prev=4,t.next=7,new Promise((function(e,t){var i=setTimeout((function(){r.monitors.running&&t(new Si("StreamingMonitor.sendPing",mi.TIMEOUT,"Received no message from WebSocket in ".concat(n,"ms!")))}),n),o=Date.now();r.client.ping((function(n,s){clearTimeout(i),r.monitors.running&&(s?t(new Si("StreamingMonitor.sendPing",mi.TIMEOUT,"WebSocket ping response timed out!")):200!==n.payload.status?t(new Si("StreamingMonitor.sendPing",mi.UNKNOWN_STATUS,"WebSocket responded with unknown status!")):"Ping successful."!==n.payload.message?t(new Si("StreamingMonitor.sendPing",mi.UNKNOWN_MESSAGE,"WebSocket responded with unknown message!")):(Gr.silly(Lr.STREAMING_MONITOR,"received monitoring ping response in ".concat(Date.now()-o,"ms")),e()))}))}));case 7:t.next=17;break;case 9:if(t.prev=9,t.t0=t.catch(4),Gr.warn(Lr.STREAMING_MONITOR,t.t0),!(e+1<this.retryCount)){t.next=16;break}return t.abrupt("return",this.sendPing(e+1));case 16:return t.abrupt("return",Promise.reject(t.t0));case 17:case"end":return t.stop()}}),t,this,[[4,9]])})))}},{key:"updateStatus",value:function(e,t){var n=t.payload.status,r=[];if(e.forEach((function(e){var t;n[e.SERVICENAME]&&(e.isAvailable="available"===n[e.SERVICENAME],e.isAvailable||r.push((t=e.SERVICENAME,"".concat(t[0].toUpperCase()).concat(t.slice(1)))))})),r.length>0){var i=new Si("StreamingMonitor.updateStatus",mi.SERVICE_UNAVAILABLE,"Following service".concat(1===r.length?" is":"s are"," no longer available:\n- ").concat(r.join("\n- ")));Gr.warn(Lr.STREAMING_MONITOR,i),this.notify(i,!1)}}},{key:"notify",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&this.stop(!0),Gr.warn(Lr.STREAMING_MONITOR,e);var n,r=_createForOfIteratorHelper(this.disconnectListeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;i(e)}}catch(e){r.e(e)}finally{r.f()}}},{key:"addDisconnectListener",value:function(e){this.disconnectListeners.push(e)}},{key:"removeDisconnectListener",value:function(e){this.disconnectListeners=this.disconnectListeners.filter((function(t){return t!==e}))}}]),e}(),Li=function(){function e(t,n){var r=this;_classCallCheck2(this,e),this.timeout=3e3,this.connected=!1,this.latency=0,this.serverAvailable=!0,this.serviceAuth=n,this.serviceAuth.addSessionExpiredListener((function(){r.isConnected&&r.disconnect()})),this.config=t,this.defaultStreaming=new _i(this,this.serviceAuth),this.marketDataStreaming=new ki(this),this.quoteTradeStreaming=new Mi(this),this.streamingMonitor=new Ui(this),this.streamingMonitor.addDisconnectListener((function(e){return r.connectionLost(e)}))}return _createClass(e,[{key:"Auth",get:function(){return this.serviceAuth}},{key:"setSockEndpoint",value:function(e){this.config.trading.sock_url=e}},{key:"getSockEndpoint",value:function(){return this.config.trading.sock_url}},{key:"setWebSocketEndpoint",value:function(e){this.config.trading.ws_url=e}},{key:"getWebSocketEndpoint",value:function(){return this.config.trading.ws_url}},{key:"Timeout",get:function(){return this.timeout},set:function(e){this.timeout=e}},{key:"isConnected",get:function(){return this.connected}},{key:"Latency",get:function(){return this.latency}},{key:"isServerAvailable",get:function(){return this.serverAvailable}},{key:"isServiceAvailable",get:function(){return{MarketData:!!this.connected&&this.MarketData.isAvailable,QuoteTrade:!!this.connected&&this.QuoteTrade.isAvailable}}},{key:"connect",value:function(e,t,n,i){return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this._connect(e,t,n,i,!1));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"_connect",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;return r(this,void 0,void 0,_regeneratorRuntime().mark((function r(){var s=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!this.pendingConnect){r.next=2;break}return r.abrupt("return",this.pendingConnect);case 2:if(!this.connected){r.next=4;break}return r.abrupt("return",!0);case 4:if(this.isServerAvailable||o){r.next=6;break}throw new Si("Streaming.connect",mi.SOCKET_UNAVAILABLE,"Socket not available");case 6:return this.pendingConnect=this.Auth.isSessionValid().then((function(e){if(!e)throw new Si("Streaming.connect",mi.SESSION_INVALID,"Invalid Session");return s.Auth.refreshToken()})).catch((function(){throw s.pendingConnect=null,new Si("Streaming.connect",mi.REFRESH_TOKEN_FAILED,"Could not refresh Token")})).then((function(){return s.Auth.getTokenString()})).then((function(r){return new Promise((function(o,a){var c=setTimeout((function(){s.pendingConnect=null,s.socket.close(),a(new Si("Streaming.connect",mi.TIMEOUT,"WebSocket connect timed out! No response in ".concat(s.Timeout,"ms")))}),s.Timeout);Gr.silly(Lr.STREAMING,"Started connect timeout timer (id: ".concat(c,")")),s.socket=new Rr("".concat(s.getSockEndpoint(),"?jwt=").concat(r),null,e),s.socket.onopen=function(){Gr.info(Lr.STREAMING,"Connected to WebSocket"),s.connectOptions={options:e,error:t,connectionLost:n,connectionRestored:i},s.cancelTokenRefresh=setInterval((function(){return s.Auth.getToken().then((function(e){var t=e.exp;t-Date.now()<=6e4&&(s.refreshToken(),Gr.silly(Lr.STREAMING,"Requested new token, exp of current token ".concat(t-Date.now(),"ms")))}))}),1e4),Gr.silly(Lr.STREAMING,"Started Token refresh interval"),s.streamingMonitor.start(e.monitor||{},s.MarketData),clearTimeout(c),Gr.silly(Lr.STREAMING,"Stopped connect timeout timer (id: ".concat(c,")")),s.connected=!0,s.pendingConnect=null,o(!0)},s.socket.onclose=s.socketCloseHandler.bind(s),s.socket.onmessage=s.socketMessageHandler.bind(s),t&&(s.socket.onerror=t.bind(s))}))})),r.abrupt("return",this.pendingConnect);case 8:case"end":return r.stop()}}),r,this)})))}},{key:"disconnect",value:function(){var e=this;if(this.isConnected){var t={header:{service:pi.DEFAULT,messageType:vi.CANCEL,version:"v1"},payload:{}};return new Promise((function(n,r){var i=setTimeout((function(){r(new Si("Streaming.disconnect",mi.TIMEOUT,"Websocket disconnect timed out!"))}),e.Timeout);e.socket.onclose=function(t){clearTimeout(i),e.marketDataStreaming.clearSubscriptions(),e.quoteTradeStreaming.clearSubscriptions(),e.socketCloseHandler(t),n(!0)},e.socket.send(JSON.stringify(t)),e.socket.close(1e3)}))}throw new Si("Streaming.disconnect",mi.NOT_CONNECTED,"Can't disconnect, currently not connected to Socket.")}},{key:"reconnect",value:function(){var e=this;this.cancelReconnect||(this.cancelReconnect=setTimeout((function(){e.isConnected||(Gr.silly(Lr.STREAMING,"Starting reconnect attempt"),e._connect(e.connectOptions.options,e.connectOptions.error,e.connectOptions.connectionLost,e.connectOptions.connectionRestored,!0).then((function(t){if(e.serverAvailable=!0,t)return e.pingAsync(e.streamingMonitor.Timeout);throw new Error("Connect failed!")})).then((function(){Gr.error(Lr.STREAMING,"Connection to WebSocket restored!"),clearTimeout(e.cancelReconnect),e.cancelReconnect=null,e.connectOptions.connectionRestored&&e.connectOptions.connectionRestored(),e.MarketData.resubscribe()})).catch((function(t){Gr.silly(Lr.STREAMING,"Reconnect attempt failed: ".concat(t)),e.cancelReconnect=null,e.serverAvailable=!1,e.reconnect()})))}),4e3))}},{key:"send",value:function(e){"string"==typeof e?this.socket.send(e):this.socket.send(JSON.stringify(e))}},{key:"socketCloseHandler",value:function(e){this.cancelTokenRefresh&&clearInterval(this.cancelTokenRefresh),this.streamingMonitor.stop(),this.serverAvailable=!0,this.connected=!1,this.pendingConnect=void 0,!e||3e3!==e.code&&1006!==e.code||(this.serverAvailable=!1,Gr.error(Lr.STREAMING,"Connection to WebSocket closed! (".concat(e.code,")\n")),this.socket.close(),this.reconnect())}},{key:"socketMessageHandler",value:function(e){var t=JSON.parse(e.data),n=t.header;Ai.emit(n.service,n.messageType,t)}},{key:"connectionLost",value:function(e){e.status!==mi.SERVICE_UNAVAILABLE?(Gr.error(Lr.STREAMING,"Connection to WebSocket lost!\n".concat(e.status)),this.serverAvailable=!1,this.socket.close(),this.connectOptions.connectionLost&&this.connectOptions.connectionLost(e),this.reconnect()):Gr.error(Lr.STREAMING,"Connection to Datasource lost!\n".concat(e.status,"\n").concat(JSON.stringify(this.isServiceAvailable,null,2)))}},{key:"ping",value:function(e){this.defaultStreaming.ping(e)}},{key:"pingAsync",value:function(e){var t=this;return new Promise((function(n,r){var i=setTimeout(r,e);t.ping((function(e,t){clearTimeout(i),t?r(t):n(e)}))}))}},{key:"refreshToken",value:function(e){var t=this,n=Date.now();this.defaultStreaming.refreshToken((function(r,i){t.latency=Date.now()-n,Gr.silly(Lr.STREAMING,"Refreshed token in ".concat(t.latency,"ms")),e&&e(r,i)}))}},{key:"MarketData",get:function(){return this.marketDataStreaming}},{key:"QuoteTrade",get:function(){return this.quoteTradeStreaming}}]),e}(),Pi=function(){function e(t){_classCallCheck2(this,e),this.Auth=t}return _createClass(e,[{key:"getUserScopes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"boolean"==typeof e&&(n=t,t=e,e=void 0),this.get("",t,e,"scopes",n)}},{key:"getUserSettings",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return"boolean"==typeof e&&(n=e,e=void 0,"boolean"==typeof t&&(r=t,t=void 0)),("string"==typeof e||Array.isArray(e))&&"boolean"==typeof t&&(r=n,n=t,t=void 0),"string"==typeof e?this.get("/usersettings/".concat(e),n,t,"itemIds",r):this.get("/usersettings",n,e,"domains",r)}},{key:"updateUserSettings",value:function(e,t,n){return"string"==typeof t?this.update("/usersettings/".concat(e),n,t):this.update("/usersettings",e,t)}},{key:"deleteUserSettings",value:function(e,t){return void 0===e?this.Auth.delete("/userdata/usersettings"):"string"==typeof e?this.update("/usersettings/".concat(e),t):this.delete("/usersettings",e,"domains")}},{key:"getWorkspaces",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.get("/workspaces",t,e,"itemIds",n)}},{key:"updateWorkspaces",value:function(e,t){return this.update("/workspaces",e,t)}},{key:"deleteWorkspaces",value:function(e){return this.delete("/workspaces",e)}},{key:"getWatchlists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.get("/watchlists",t,e,"itemIds",n)}},{key:"updateWatchlists",value:function(e,t){return this.update("/watchlists",e,t)}},{key:"deleteWatchlists",value:function(e){return this.delete("/watchlists",e)}},{key:"getWidgets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.get("/widgets",t,e,"itemIds",n)}},{key:"updateWidgets",value:function(e,t){return this.update("/widgets",e,t)}},{key:"deleteWidgets",value:function(e){return this.delete("/widgets",e)}},{key:"getPortfolios",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.get("/portfolios",t,e,"itemIds",n)}},{key:"updatePortfolios",value:function(e,t){return this.update("/portfolios",e,t)}},{key:"deletePortfolios",value:function(e){return this.delete("/portfolios",e)}},{key:"get",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"itemIds",i=arguments.length>4?arguments[4]:void 0;"boolean"==typeof n&&(t=n);var o="/userdata".concat(e);return"string"==typeof n?o+="/".concat(n,"?"):"object"===_typeof2(n)?o+=this.generateURLParams(n,r):o+="?",o+="&includeSource=".concat(t),o+=void 0!==i?"&idsonly=".concat(i):"",this.Auth.get(o)}},{key:"update",value:function(e,t,n){if("string"==typeof t){var r=n;n=t,t=r}return this.Auth.put("/userdata".concat(e).concat(n?"/"+n:""),t)}},{key:"delete",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"itemIds",r="/userdata".concat(e);return"string"==typeof t?r+="/".concat(t):"object"===_typeof2(t)&&(r+=this.generateURLParams(t,n)),this.Auth.delete(r)}},{key:"generateURLParams",value:function(e,t){return"?"+e.reduce((function(e,n){return e+"&".concat(t,"=").concat(n)}),"")}}]),e}(),xi=new Oe(Pr),ji=new ge(Pr,xi),Bi=new ke(Pr,xi),Gi=new Ie(Bi),Ki=new Ti(Pr,xi),Qi=new Li(Pr,xi),Fi=new Pi(xi);return{config:Pr,Admin:ji,Auth:xi,Rest:Bi,RestPolling:Gi,Streaming:Ki,Trading:Qi,UserData:Fi,ServiceAdmin:ji,ServiceAuth:xi,ServiceRest:Bi,ServiceRestPolling:Gi,ServiceStreaming:Ki,ServiceUserData:Fi}}));
//# sourceMappingURL=sdk.umd.js.map
